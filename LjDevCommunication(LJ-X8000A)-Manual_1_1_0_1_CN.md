[1 软件使用许可协议条款](#1-软件使用许可协议条款)[2 前言](#2-前言)[3 运行环境](#3-运行环境)[3.1 硬件规格与系统要求](#31-硬件规格与系统要求)[3.2 基本运行环境](#32-基本运行环境)[Microsoft C/C++ Runtime Library](#microsoft-cc++-runtime-library)[Microsoft .NET Framework](#microsoft-net-framework)[CodeMeterRuntime](#codemeterruntime)[4 文件构成](#4-文件构成)[5 嵌入方法](#5-嵌入方法)[6 图像结构定义](#6-图像结构定义)[6.1 高度图像结构体定义](#61-高度图像结构体定义)[6.1 亮度图像结构体定义](#61-亮度图像结构体定义)[7 图像接收完成时的回调函数](#7-图像接收完成时的回调函数)[7.1 图像接收完成回调函数委托定义](#71-图像接收完成回调函数委托定义)[7.2 回调函数通讯状态指示](#72-回调函数通讯状态指示)[7.3 回调函数调用详情](#73-回调函数调用详情)[7.4 图像获取时序图](#74-图像获取时序图)[8 函数](#8-函数)[命名空间/类名称](#命名空间类名称)[8.1 函数一览](#81-函数一览)[8.1.1 对DLL的操作](#811-对dll的操作)[8.1.2 建立/断开与控制器之间的Ethernet连接](#812-建立断开与控制器之间的ethernet连接)[8.1.3 硬件控制相关](#813-硬件控制相关)[8.1.4 测量控制相关](#814-测量控制相关)[8.1.5 变更/读取设定相关](#815-变更读取设定相关)[8.1.6 图像获取相关](#816-图像获取相关)[8.2 函数说明](#82-函数说明)[8.2.1  对DLL的操作](#821--对dll的操作)[■ Initialize（DLL初始化）](#■-initializedll初始化)[■ Finalize（DLL处理终止）](#■-finalizedll处理终止)[8.2.2 建立/断开与控制器之间的Ethernet连接](#822-建立断开与控制器之间的ethernet连接)[■ CommunicationOpen（创建PC与控制器的以太网连接）](#■-communicationopen创建pc与控制器的以太网连接-)[■ CommunicationClose（断开PC与控制器间的以太网连接）](#■-communicationclose断开pc与控制器间的以太网连接-)[8.2.3 硬件控制相关](#823-硬件控制相关)[■ ControlLaser（控制激光ON/OFF）](#■-controllaser控制激光onoff-)[■ GetError（获取控制器系统错误）](#■-geterror获取控制器系统错误-)[■ ClearError（解除控制器系统错误）](#■-clearerror解除控制器系统错误-)[■ TrgErrorReset（复位TRG_ERROR状态）](#■-trgerrorreset复位trgerror状态-)[■ GetAttentionStatus（获取TRG_ERROR/MEM_FULL/TRG_PASS的状态）](#■-getattentionstatus获取trgerrormemfulltrgpass的状态-)[8.2.4 硬件控制相关](#824-硬件控制相关)[■ StartMeasure（开始批处理测量/开始多台控制器同步）](#■-startmeasure开始批处理测量开始多台控制器同步-)[■ StopMeasure（结束批处理测量/停止多台控制器同步）](#■-stopmeasure结束批处理测量停止多台控制器同步-)[■ ClearMemory（清除控制器内存）](#■-clearmemory清除控制器内存)[8.2.5 写入/读取设定相关](#825-写入读取设定相关)[指定要执行写入/读取的目标设定项目](#指定要执行写入读取的目标设定项目)[■ SetSetting（发送设定）](#■-setsetting发送设定)[■ GetSetting（获取设定）](#■-getsetting获取设定)[■ InitializeSetting（初始化设定）](#■-initializesetting初始化设定)[■ RewriteTemporarySetting（更新设定写入区域）](#■-rewritetemporarysetting更新设定写入区域)[■ ReflectSetting（设定写入区域的生效请求）](#■-reflectsetting设定写入区域的生效请求)[■ CheckMemoryAccess（确认设定保存区域的保存处理情况）](#■-checkmemoryaccess确认设定保存区域的保存处理情况)[■ ChangeActiveProgram（切换活动程序编号）](#■-changeactiveprogram切换活动程序编号)[■ GetActiveProgram（获取活动程序编号）](#■-getactiveprogram获取活动程序编号)[设定的写入处理](#设定的写入处理)[• 目标设定区域](#-目标设定区域)[• 修改多个设定项目时](#-修改多个设定项目时)[• 仅修改单个设定项目时](#-仅修改单个设定项目时)[• 将本地的设定文件写入控制器时[批量修改设定]](#-将本地的设定文件写入控制器时批量修改设定)[设定错误详情](#设定错误详情)[8.2.6 图像获取相关](#826-图像获取相关)[■ StartImageReceiving（开始图像高速传输）](#■-startimagereceiving开始图像高速传输)[■ StopImageReceiving（停止图像传输）](#■-stopimagereceiving停止图像传输)[■ GetCurrentImageReceivingState（获取当前图像获取状态）](#■-getcurrentimagereceivingstate获取当前图像获取状态)[9 错误代码](#9-错误代码)[9.1 通讯库错误代码](#91-通讯库错误代码)[9.1.1 通用错误返回代码](#911-通用错误返回代码)[9.1.2 控制器处理错误返回代码](#912-控制器处理错误返回代码)[9.1.3 特殊错误返回代码](#913-特殊错误返回代码-)[9.2 控制器错误代码](#92-控制器错误代码)[10 附录](#10-附录)[10.1 发送/接收设定](#101-发送接收设定)[10.2 批量发送/接收设定](#102-批量发送接收设定)[10.3 发送/接收设定项目详情](#103-发送接收设定项目详情)[10.3.1 环境设定 设定项目列表](#1031-环境设定-设定项目列表)[10.3.2 修改/读取测量通用设定 设定项目列表](#1032-修改读取测量通用设定-设定项目列表)[10.3.3 各程序内的设定时 设定项目列表](#1033-各程序内的设定时-设定项目列表)[■ 触发设定内的设定项目](#■-触发设定内的设定项目)[各系列感测头采样周期的设置值](#各系列感测头采样周期的设置值)[防止相互干扰设定值](#防止相互干扰设定值)[■ 拍摄设定内的设定项目](#■-拍摄设定内的设定项目)[X方向测量范围设定值](#x方向测量范围设定值)[Z方向测量范围设定值](#z方向测量范围设定值)[LJ-X感测头Z方向测量范围大小设定值：](#lj-x感测头z方向测量范围大小设定值)[曝光时间设定值](#曝光时间设定值)[■ 轮廓设定内的设定项目](#■-轮廓设定内的设定项目)[倾斜补正设定数据数组详情](#倾斜补正设定数据数组详情)[高度补正设定数据数组详情](#高度补正设定数据数组详情)


# '>1 软件使用许可协议条款

对LJ Developer(以下简称“本软件”)的使用，以用户接受下列软件使用许可协议（以下称“本协议”）为前提条件。若用户将本软件的全部或部分安装或复制到设备和计算机，或使用安装于设备和计算机上的本软件，则视同用户已接受本协议的所有条款，本协议成立生效。

第1条 (使用权的承诺)
以用户遵守本协议为条件，KEYENCE CORPORATION(以下简称“本公司”)承诺用户的非独占性使用权。

第2条 (复制限制)
仅在用户需要备份本软件或需要向前条所规定的第三者进行转让时，可对本软件进行复制。

第3条 (禁止事项)
禁止用户对本软件进行以下行为。
a. 变更或增加本软件的部分或全部功能的修改行为。但是，有本公司提供更新程序或安装添加功能等，本公司明确授权的行为除外。
b. 反向编译或反向装配等，解读本软件的所有逆向工程行为。
c. 将本软件对第三者进行转卖、转让、重新分发、使用授权、租赁、出租等行为。但事先得到本公司认可的情况除外。

第4条（版权等）
本软件及本软件手册相关的版权等知识产权归本公司所有。

第5条（免责）
对于因使用本软件而对用户或第三者造成的损害，本公司概不负责。

第6条（终止合同）


- 用户通过废弃本软件及其复制物等手段停止使用本软件之时起，本协议自动终止。

- 若用户违反本协议任一条款，本公司可单方面解除本协议。此时，应立即废弃本软件及其复制物或将其返还至本公司。

- 若因用户违反本协议而对本公司造成损害，用户须赔偿本公司损失。


第7条（准据法和管辖权）
本协议基于日本国法律而生效。此外，关于本合同的一切纠纷将交由作为专属协议管辖法院的大阪地方法院予以裁决。


# '>2 前言

LJ Developer通讯库，适用于LJ Developer从LJ-X8000A控制器获取图像数据及其他处理时必要的感测头信息、设定参数信息。


# '>3 运行环境

## '>3.1 硬件规格与系统要求


项目 | 必要条件

**操作系统** | Microsoft Windows 11 Pro (64bit)、Microsoft Windows 10 Pro (64bit)

**CPU** | 基于intel®CoreTM i5 处理器或更高

**内存容量** | 16 GB 以上

**接口** | 配备下列任意一项。

**开发环境** | Microsoft Visual Studio 2017 C#7.3 或更高版本


・不保证连接到 LAN 和使用路由器连接时的操作状况。

・必要的硬件环境很大程度取决于作为处理对象的图像尺寸和所使用的处理功能。
・Windows是美国Microsoft Corporation在美国及其他国家的注册商标或商标。

## '>3.2 基本运行环境

为了确保通信库的正确运行，必须准备如下环境：

### Microsoft C/C++ Runtime Library

Microsoft C Runtime Library。
请运行并安装vcredist_x64.exe。

### Microsoft .NET Framework

LjDevMeasure.dll基于.NET Framework 4.7.2开发。
请运行并安装ndp472-kb4054530-x86-x64-allos-enu.exe。

### CodeMeterRuntime

请运行并安装CodeMeterRuntime.exe。

此外，请将cpsevents-6002427文件夹放置在与执行文件相同的文件夹中。

cpsevents-6002427文件夹存储在C:\Program Files\KEYENCE \LJ Developer\lib\x64中。


# '>4 文件构成

运行测量库所需的文件（LjDevCommunication.dll、LJX8_IF.dll、LjDevCommon.dll、LjDevCommon.Core.dll）存储在如下位置

C:\Program Files\KEYENCE \LJ Developer\lib\x64


# '>5 嵌入方法

请将如下文件与可执行应用程序放置在同一文件夹内


- LJX8_IF.dll

- LjDevCommunication.dll

- LjDevCommon.dll

- LjDevCommon.Core.dll


# '>6 图像结构定义

从控制器取得的数据为高度、浓淡与附加信息混合的多行轮廓数据。

为了便于后续图像处理，轮廓数据在传输到用户应用程序前转换为便于处理的图像结构。

注意点:


- LJ Developer提供的测量处理，以XY等比例（CoefficientX = CoefficientY）图像的处理为前提。

- 在开始图像高速传输（StartImageReceiving)时，如果指定参数equalizePixcelDensity为true，则图像数据将自动修正为XY等比例（CoefficientX = CoefficientY)后传回。


## '>6.1 高度图像结构体定义

高度图像结构体的公开对象定义如下。

```


/// 高度图像结构体公开对象
```

```
public struct LHeightImage
```

```
    {
```

```
     /// 高度图像的像素数值数组，数组长度为XSize * YSize
```

```
        public ushort[] Source;
```

```
     /// 高度图像的X方向点数
```

```
        public int XSize;
```

```
     /// 高度图像的行数
```

```
        public int YSize;
```

```
     /// X方向的比例系数,即X方向像素点之间的真实距离,单位为mm
```

```
        public double CoefficientX;
```

```
     /// Y方向的比例系数,即轮廓与轮廓之间的真实触发间距,单位为mm
```

```
        public double CoefficientY;
```

```
     /// Z方向的比例系数,单位为mm
```

```
        public double CoefficientZ;
```

```
    }
```
以4 * 4的图像为例，示意图如下：


![./ImageDetail.svg](ImageSample) | 如左侧示意图 XSize为图像的宽度，与单条轮廓数据的点数一致。 YSize为图像的行数，即图像中包含多少行轮廓。 Source为对应的像素1维数组，左侧图示中的数字为每个像素值在数组中的序号，数组长度为XSize * YSize。 CoefficientX是图像上的1个像素对应的实际真实距离，单位是mm。 CoefficientY是图像上行与行之间对应的实际真实距离，单位是mm。


各型号感测头在默认设定下的比例系数如下（单位：mm）：


LJ-X感测头 | LJ-X8020 | LJ-X8060 | LJ-X8080 | LJ-X8200 | LJ-X8300 | LJ-X8400 | LJ-X8900

CoefficientX | 0.0025 | 0.005 | 0.0125 | 0.025 | 0.05 | 0.075 | 0.225

CoefficientZ | 0.0004 | 0.0008 | 0.0016 | 0.004 | 0.004 | 0.008 | 0.016


LJ-V感测头 | LJ-V7020(K)(B) | LJ-V7060(K)(B) | LJ-V7080(B) | LJ-V7200(B) | LJ-V7300(B)

CoefficientX | 0.01 | 0.02 | 0.05 | 0.1 | 0.3

CoefficientZ | 0.0004 | 0.0008 | 0.0016 | 0.004 | 0.008


## '>6.1 亮度图像结构体定义

亮度图像结构体的公开对象定义如下。

```


xxxxxxxxxx
```

```
/// 亮度图像结构体公开对象
```

```
public struct LGrayImage
```

```
    {
```

```
        /// 亮度图像的像素数值数组，数组长度为XSize * YSize
```

```
        public byte[] Source;
```

```
     /// 高度图像的X方向点数
```

```
        public int XSize;
```

```
     /// 高度图像的行数
```

```
        public int YSize;
```

```
     /// X方向的比例系数,即X方向像素点之间的真实距离,单位为mm
```

```
        public double CoefficientX;
```

```
     /// Y方向的比例系数,即轮廓与轮廓之间的真实触发间距,单位为mm
```

```
        public double CoefficientY;
```

```
    }
```
亮度图像结构体公开成员与高度图像类似，各成员请参照高度图像结构体公开成员。


# '>7 图像接收完成时的回调函数

控制器向PC实时传输轮廓数据，当PC从控制器取得指定数量的轮廓数据，将轮廓数据转换成图像。

从开始扫描图像到数据传输结束图像创建完毕之间存在时间间隔。

为了避免取图过程应用程序线程堵塞，采用异步模式获取轮廓，图像创建完成时，调用回调函数通知主程序。

图像完成回调函数的详情如下所示。用于 StartImageReceiving指令。

## '>7.1 图像接收完成回调函数委托定义

```


xxxxxxxxxx
```

```
/// 图像接收完成回调函数定义
```

```
/// 在图像获取完成后或通信状态异常时进行调用，用于通知主程序图像获取状态。
```

```
/// 该回调函数由图像获取线程调用，与主程序线程处于不同线程。
```

```
/// 由于回调函数所处线程为通讯线程，回调函数运行时间过长时，可能造成通讯异常。
```

```
/// 因此，不可在回调函数内直接处理图像数据。
```

```
///
```

```
public delegate void ImageReceivedCallback(
```

```
    /// [输出]获取到的高度图像
```

```
    LHeightImage heightImage,
```

```
    /// [输出]获取到的亮度图像
```

```
    LGrayImage grayImage,
```

```
    /// [输出]通讯状态指示
```

```
    ReceivedStatus notify);
```

## '>7.2 回调函数通讯状态指示

回调函数返回时，将同时返回当前通讯状态的指示值（ReceivedStatus），定义如下：


定义 | 含义

ImageReceived | 停止连续发送（通过命令停止）

SettingChanged | 停止连续发送（由于设定变更自动停止）

ProgramNoChanged | 停止连续发送（由于程序切换自动停止）

CommunicationInterrupted | 被外部强制中断通信

MemoryCleared | 由于清除内存，通讯中断


## '>7.3 回调函数调用详情

DLL与控制器建立高速数据通信后，DLL通过独立通信线程实时接收LJ-X8000A传送的轮廓数据并暂时储存在DLL的内部缓存 （buffer）。

当缓存中的轮廓数据达到指定数量时，将调用图像完成回调函数。

除图像传输完成外，当发生通信异常等问题时，也通过调用回调函数通知主程序，请参照 [回调函数错误代码](#回调函数错误代码)进行问题排查与解决。


## '>7.4 图像获取时序图


LJX8000A控制器LJ Developer通讯库主程序运动机构
- LJX8000A控制器LJ Developer通讯库主程序运动机构loop[实时缓存轮廓数据]满足条件后，根据轮廓数据创建图像运动机构扫描到位后自行停止或回位14、主程序在回调函数结束后对复制的图像执行图像处理loop[连续取图测量时循环执行部分]1、调用连接指令CommunicationOpen2、创建Ethernet连接3、调用开始图像传输指令StartImageReceiving4、创建图像传输专用通道[用于实时传输轮廓数据]5、调用批处理开始指令StartMeasure6、发送批处理开始信号7、控制运动机构开始扫描使用图像传输通道实时传送轮廓数据写入内部缓存(buffer)8、运动机构扫描到位9、调用批处理结束指令StopMeasure10、结束批处理测量11、调用回调函数通知主程序获取图像12、回调函数内复制图像数据13、回调函数返回[不建议在回调函数内直接处理图像]15、停止图像传输StopImageReceiving16、断开图像传输通道17、调用断开连接指令CommunicationClose18、断开Ethernet连接
# '>8 函数

## 命名空间/类名称
本章中所述的全部函数、结构体、枚举定义，均位于如下类（LjDevCommunication.Ljx8If）：命名空间/NameSpace：LjDevCommunication

- 类/Class:Ljx8If


## '>8.1 函数一览

本通讯库的函数不支持多线程的调用。请从单一线程调用函数。

### '>8.1.1 对DLL的操作

即使控制器发生系统错误，也会被正常处理。


**函数名** | **概要** | **特殊错误代码**

[Initialize](#Initialize) | 初始化 DLL | -

[Finalize](#Finalize) | DLL 终止处理 | -


### '>8.1.2 建立/断开与控制器之间的Ethernet连接

即使控制器发生系统错误，也会被正常处理。


**函数名** | **概要** | **特殊错误代码**

[CommunicationOpen](#CommunicationOpen) | 创建PC与控制器的以太网连接 | -

[CommunicationClose](#CommunicationClose) | 断开PC与控制器间的以太网连接 | -


### '>8.1.3 硬件控制相关

附有 *1 的指令发生系统错误时，可能无法正常处理。


**函数名** | **概要** | **特殊错误代码**

[ControlLaser](#ControlLaser) | 控制激光On/OFF^*1^ | -

[GetError](#GetError) | 获取控制器系统错误 | -

[ClearError](#ClearError) | 清除控制器的系统错误 | -

[TrgErrorReset](#TrgErrorReset) | 复位TRG_ERROR状态 ^*1^ | -

[GetAttentionStatus](#GetAttentionStatus) | 获取TRG_ERROR/MEM_FULL/TRG_PASS的状态 | -


### '>8.1.4 测量控制相关

在控制器系统错误状态下，如下函数处理失败。


**函数名** | **概要** | **特殊错误代码**

[StartMeasure](#StartMeasure) | 开始批处理测量/开始多台控制器同步 | [0x8080/0x80A0](#特殊错误代码)

[StopMeasure](#StopMeasure) | 停止批处理测量/停止多台控制器同步 | [0x8080/0x80A0](#特殊错误代码)

[ClearMemory](#ClearMemory) | 清除控制器内存 | -


### '>8.1.5 变更/读取设定相关

在控制器系统错误状态下，处理失败。


**函数名** | **概要** | **特殊错误代码**

[SetSetting](#SetSetting) | 修改控制器内的设定参数值 | [0x8032](#特殊错误代码)

[GetSetting](#GetSetting) | 读取控制器内的设定参数值 | -

[InitializeSetting](#InitializeSetting) | 将指定编号的程序恢复到出厂默认设定状态 | -

[ReflectSetting](#ReflectSetting) | 将设定写入区域的内容生效到运行设定区域或保存区域中 | -

[RewriteTemporarySetting](#RewriteTemporarySetting) | 用运行设定区域或保存区域中的设定覆盖设定写入区域的内容 | -

[CheckMemoryAccess](#CheckMemoryAccess) | 确认是否正在对设定保存区域进行保存处理 | -

[ChangeActiveProgram](#ChangeActiveProgram) | 切换活动程序编号 | -

[GetActiveProgram](#GetActiveProgram) | 获取活动程序编号 | -


### '>8.1.6 图像获取相关

使用专用高速通信通道、从控制器实时获取轮廓数据并创建图像时使用。

在控制器系统错误状态下，处理失败。


**函数名** | **概要** | **特殊错误代码**

[StartImageReceiving](#StartImageReceiving) | 与控制器建立高速通信 然后开始获取图像数据 | [0x8081/0x80A0/0x80A1 0x80A2/0x80A3/0x80A4 0xA000/0xA001/0xA002](#特殊错误代码)

[StopImageReceiving](#StopImageReceiving) | 停止获取图像数据 并切断与控制器的高速通信 | -

[GetCurrentImageReceivingState](#GetCurrentImageReceivingState) | 获取当前图像获取的状态 | -

[ImageReceivedCallback](#图像接收完成回调函数) | 图像获取时，调用回调函数通知主程序。对应的委托定义 | -


## '>8.2 函数说明

大部分函数的返回值均为 int 类型。正常时返回 0 （无异常），当函数执行出现异常时，根据异常内容返回对应错误代码。

返回值有效位为下位2BYTE(上位的 2BYTE 为保留位，暂未使用)。

所有函数函通用的返回代码，请参照 [通讯库通用错误代码](#通讯库通用错误代码)。若函数存在个别的错误代码，请参照本章各函数的说明。

### 8.2.1  对DLL的操作

#### '>■ Initialize（DLL初始化）

在应用程序启动时，请务必执行1次此函数初始化DLL。

```


xxxxxxxxxx
```

```
///
```

```
/// 初始化 DLL（请务必在应用程序启动时执行1次）
```

```
/// 无特殊错误代码
```

```
///
```

```
public static int Initialize();
```

#### '>■ Finalize（DLL处理终止）

在应用程序结束前，请务必执行1次此函数终止DLL内部处理。

```


xxxxxxxxxx
```

```
///
```

```
/// 终止DLL的内部处理（请务必在应用程序结束前执行1次）
```

```
/// 无特殊错误代码
```

```
///
```

```
public static int Finalize();
```

### 8.2.2 建立/断开与控制器之间的Ethernet连接

#### '>■ CommunicationOpen（创建PC与控制器的以太网连接）

与控制器建立连接，使设备能够与通过 Ethernet 连接的控制器进行通信。

```


xxxxxxxxxx
```

```
/// 与控制器建立连接，使设备能够与通过 Ethernet 连接的控制器进行通信
```

```
/// 同时、传入的IP地址在开始图像高速传输时会被使用
```

```
/// 将当前连接对应的控制器在DLL内部定义编号为deviceId指定的数值,其他函数将使用此编号进行已连接的控制器的指定
```

```
/// 无特殊错误代码
```

```
///
```

```
public static int CommunicationOpen(
```

```
    /// [输入]设备ID
```

```
    int deviceId,
```

```
    /// [输入]指定目标控制器的IP地址，长度为4
```

```
    byte[] ipaddress,
```

```
    // [输入]指定目标控制器的指令端口号
```

```
    ushort portNo);
```

> 注意点：1、1台PC可以同时通信的控制器台数上限为6台（连接超过 6 台时，无法确认或保证动作）2、设备ID可在0~127之间自行选择，但是，不同控制器连接时必须指定为不同的ID3、1台控制器最多可以同时与3台PC进行以太网通讯。当连接到第4台PC时，已连接的3台PC中，会将已连接的 3 台PC中最终通信时间距今最久的连接断开4、1台控制器只能与1台PC上进行高速数据通信5、请在LJ-X Navigator软件关闭的状态下开启高速数据通信

#### '>■ CommunicationClose（断开PC与控制器间的以太网连接）
断开PC与控制器之间的Ethernet连接。在未建立连接的状态下调用时，不做处理直接正常返回。

```


xxxxxxxxxx
```

```
///
```

```
/// 断开PC与控制器之间的Ethernet连接
```

```
/// 无特殊错误代码
```

```
///
```

```
public static int CommunicationClose(
```

```
    /// [输入]要操作的设备ID
```

```
    int deviceId);
```

> 注意点：设备ID用于指定要操作的控制器，请传入创建控制器连接时指定的数值，详情请参照[创建PC与控制器之间的以太网连接](#CommunicationOpen)

### 8.2.3 硬件控制相关

#### '>■ ControlLaser（控制激光ON/OFF）
控制激光ON[允许发光]或OFF[禁止发光]。

```


xxxxxxxxxx
```

```
///
```

```
/// 控制激光ON[允许发光]或OFF[禁止发光]
```

```
/// 无特殊错误代码
```

```
///
```

```
public static int ControlLaser(
```

```
    /// [输入]要操作的设备ID
```

```
    int deviceId,
```

```
    /// [输入]指定激光的状态[0：禁止发光 其他数值：允许发光]
```

```
    byte state);
```

> 注意点：设备ID用于指定要操作的控制器，请传入创建控制器连接时指定的数值，详情请参照[创建PC与控制器之间的以太网连接](#CommunicationOpen)

#### '>■ GetError（获取控制器系统错误）

获取控制器当前的硬件系统错误信息，有关获取到的错误代码含义，请参照[控制器错误代码](#控制器错误代码)

```


xxxxxxxxxx
```

```
///
```

```
/// 获取控制器当前的系统错误信息
```

```
/// 无特殊错误代码
```

```
///
```

```
public static int GetError(
```

```
    /// [输入]要操作的设备ID
```

```
    int deviceId,
```

```
    /// [输出]实际获取到的系统错误的个数
```

```
    ref byte errorCount,
```

```
    /// [输出]获取到的系统错误
```

```
    ref ushort[] errorCodes);
```

> 注意点：1、设备ID用于指定要操作的控制器，请传入创建控制器连接时指定的数值，详情请参照[创建PC与控制器之间的以太网连接](#CommunicationOpen)2、若控制器当前未发生系统错误，则errorCount为03、当前函数返回值，请参照[通讯库通用错误代码](#通讯库通用错误代码)，errorCodes内的错误代码，请参照[控制器错误代码](#控制器错误代码)

#### '>■ ClearError（解除控制器系统错误）

解除控制器的对应系统错误。在所有系统错误被成功解除前，控制器将一直处于不能测量的状态。

```


xxxxxxxxxx
```

```
///
```

```
/// 解除控制器的对应系统错误
```

```
/// 无特殊错误代码
```

```
///
```

```
public static int ClearError(
```

```
    /// [输入]要操作的设备ID
```

```
    int deviceId,
```

```
    /// [输入]需要解除的错误的错误代码，仅限0x0085和0x0086错误
```

```
    ushort errCode);
```

> 注意点：1、设备ID用于指定要操作的控制器，请传入创建控制器连接时指定的数值，详情请参照[创建PC与控制器之间的以太网连接](#CommunicationOpen)2、并非所有的硬件系统错误都可解除，可以通过此函数解除的错误如下：
> 	0x0085：与前次启动时连接的感测头型号不同
> 	0x0086：连接的感测头是本机不支持的版本3、上述错误外其他错误的解决方案，请参照[控制器错误代码](#控制器错误代码)。

#### '>■ TrgErrorReset（复位TRG_ERROR状态）

将控制器的TRG_ERROR复位为OFF。

```


xxxxxxxxxx
```

```
///
```

```
/// 将控制器的TRG_ERROR端子复位为OFF
```

```
/// 无特殊错误代码
```

```
///
```

```
public static int TrgErrorReset(
```

```
    /// [输入]要操作的设备ID
```

```
    int deviceId);
```

> 注意点：1、设备ID用于指定要操作的控制器，请传入创建控制器连接时指定的数值，详情请参照[创建PC与控制器之间的以太网连接](#CommunicationOpen)2、控制器上没有TRG_ERROR端子，但可以在LJ-X Navigator的显示端子动作画面上确认3、LJ-X Navigator不能复位TRG_ERROR，只能通过此函数复位

#### '>■ GetAttentionStatus（获取TRG_ERROR/MEM_FULL/TRG_PASS的状态）

读取控制器TRG_ERROR/MEM_FULL/TRG_PASS的当前状态。

```


xxxxxxxxxx
```

```
///
```

```
/// 读取控制器TRG_ERROR/MEM_FULL/TRG_PASS的当前状态
```

```
/// 无特殊错误代码
```

```
///
```

```
public static int GetAttentionStatus(
```

```
    /// [输入]要操作的设备ID
```

```
    int deviceId,
```

```
    /// [输出]获取到的状态字，ON:1、OFF:0
```

```
    /// 0bit：TRG_ERROR，6bit：MEM_FULL，7bit：TRG_PASS
```

```
    ///
```

```
    ref ushort attentionStatus);
```

> 注意点：1、设备ID用于指定要操作的控制器，请传入创建控制器连接时指定的数值，详情请参照[创建PC与控制器之间的以太网连接](#CommunicationOpen)2、attentionStatus为获取到的状态字，使用0、6、7bit分别代表TRG_ERROR、MEM_FULL和TRG_PASS，其他位为保留位。
> MSB(最高有效位)        LSB(最低有效位)15...7(TRG_PASS)6(MEM_FULL)543210(TRG_ERROR)3、指定位置bit为1时，对应状态为ON，指定位置bit为0时，对应状态为OFF

### 8.2.4 硬件控制相关

#### '>■ StartMeasure（开始批处理测量/开始多台控制器同步）

当控制器批处理为ON时，本函数开始批处理测量。（若控制器批处理测量在指令发出前已经开始，将不做任何处理，也不会返回错误信息）

批处理为 OFF 且多台控制器同步功能使用中时，本指令开始同步。同步开始后将开始测量。（接收触发）

```


xxxxxxxxxx
```

```
///
```

```
/// 开始批处理测量/开始多台控制器同步
```

```
/// 特殊错误代码:
```

```
/// 0x8080:批处理测量的设定为OFF,或虽然在使用多台控制器同步功能，但在“同步主站”中未设定所指定的设备。
```

```
/// 0x80A0:由于LASER_ON端子为OFF等原因，未成功进行批处理测量开始处理。
```

```
///
```

```
public static extern int StartMeasure(
```

```
        /// [输入]要操作的设备ID
```

```
        int deviceId);
```

> 注意点：设备ID用于指定要操作的控制器，请传入创建控制器连接时指定的数值，详情请参照[创建PC与控制器之间的以太网连接](#CommunicationOpen)

#### '>■ StopMeasure（结束批处理测量/停止多台控制器同步）

当控制器批处理为ON时，本函数停止批处理测量。（若批处理测量未开始，将不做任何处理，也不会返回错误信息）

批处理为OFF且多台控制器同步功能使用中时，本指令停止同步，同步停止后将停止测量。（停止接收触发）

```


xxxxxxxxxx
```

```
///
```

```
/// 结束批处理测量/停止多台控制器同步
```

```
/// 特殊错误代码:
```

```
/// 0x8080:批处理测量的设定为OFF,或虽然在使用多台控制器同步功能，但在“同步主站”中未设定所指定的设备。
```

```
/// 0x80A0:由于LASER_ON端子为OFF等原因，未成功进行批处理测量结束处理。
```

```
///
```

```
public static extern int StopMeasure(
```

```
        /// [输入]要操作的设备ID
```

```
        int deviceId);
```

> 注意点：设备ID用于指定要操作的控制器，请传入创建控制器连接时指定的数值，详情请参照[创建PC与控制器之间的以太网连接](#CommunicationOpen)

#### '>■ ClearMemory（清除控制器内存）

将控制器内存中保留的轮廓数清除。

```


xxxxxxxxxx
```

```
///
```

```
/// 将控制器内存中保留的轮廓数清除
```

```
/// 特殊错误代码:无
```

```
///
```

```
public static extern int ClearMemory(
```

```
        /// [输入]要操作的设备ID
```

```
        int deviceId);
```

> 注意点：1、设备ID用于指定要操作的控制器，请传入创建控制器连接时指定的数值，详情请参照[创建PC与控制器之间的以太网连接](#CommunicationOpen)2、清空控制器内存会导致进行中的高速数据通信中断，需重新连接高速通信

### 8.2.5 写入/读取设定相关

#### '>指定要执行写入/读取的目标设定项目

在写入/读取设定时，需要指定特定的设定项目。使用目标设定项用于指定特定设定。

目标设定项既可以指定单个设定项目，也可以指定环境设定整体/通用测量设定整体或检测程序整体(0~15)。

目标设定项结构体定义如下：

```


xxxxxxxxxx
```

```
/// 用于指定特定设定项目参数的结构体
```

```
public struct LJX8IF_TARGET_SETTING
```

```
{
```

```
    /// 指定设定项是环境设定/测量通用设定/程序0~15中的哪一项
```

```
    public byte Type;
```

```
    /// 指定设定项是触发设定/拍摄设定/轮廓设定中的哪一项
```

```
    public byte Category;
```

```
    /// 基于Type和Category后指定具体的设定项目
```

```
    public byte Item;
```

```
    /// 保留项,固定为0
```

```
    public byte reserve;
```

```
    /// Target1~4,据目标设定项，可能需要进行相应的指定。无需设定时，固定为0
```

```
    public byte Target1;
```

```
    public byte Target2;
```

```
    public byte Target3;
```

```
    public byte Target4;
```

```
};
```

> ※要读取或修改的设定项不同时，如上成员需指定为特定的固定数值
> - 修改单个设定项目时，各成员项目分别的数值，请参照[发送/接收设定项目详情](#发送/接收设定项目详情)
> - 批量修改环境设定/通用测量设定/检测程序，或发送本地设定文件时，请参照[批量发送/接收设定](#批量发送/接收设定)

#### '>■ SetSetting（发送设定）

修改控制器内的设定参数值，可用于个别设定项目的修改或设定程序的批量修改。

```


xxxxxxxxxx
```

```
///
```

```
/// 修改控制器内的设定参数值
```

```
/// 特殊错误代码:
```

```
/// 0x8032:指令长度错误(设定数据未达到规定大小时等)
```

```
///
```

```
public static int SetSetting(
```

```
    /// [输入]要操作的设备ID
```

```
    int deviceId,
```

```
    /// [输入]目标写入区域
```

```
    byte depth,
```

```
    /// [输入]要修改的特定设定项目
```

```
    LJX8IF_TARGET_SETTING targetSetting,
```

```
    /// [输入]要发送到控制器的设定数据
```

```
    ref byte[] data,
```

```
    /// [输出]发生设定错误时的详情
```

```
    ref uint error);
```

> 注意点：
> - 设备ID用于指定要操作的控制器，请传入创建控制器连接时指定的数值，详情请参照[创建PC与控制器之间的以太网连接](#CommunicationOpen)
> - depth目标写入区域：0-设定写入区域(WRITE)，1-运行设定区域(RUNNING)，2-保存区域(SAVE)
> 	关于目标写入区域的含义及注意点，请参照[目标设定区域](#目标设定区域)
> 	设定写入RUNNING或SAVE时，测量/高速通信将被中断
> - targetSetting为要修改的特定设定项目。
> 	修改单个设定项目时，请参照[发送/接收设定项目详情](#发送/接收设定项目详情)
> 	批量修改环境设定/通用测量设定/检测程序，或发送本地设定文件时，请参照[批量发送/接收设定](#批量发送/接收设定)
> - data为要发送到控制器的设定数据。不同的设定项目的设定数据长度不同，请参照targetSetting指定的设定项目。
> - error为设定写入错误时的设定错误代码，详情请参照[设定错误详情](#设定错误详情)

#### '>■ GetSetting（获取设定）

读取控制器内的设定参数值，可用于个别设定项目的读取或设定程序的批量读取。

```


xxxxxxxxxx
```

```
///
```

```
/// 读取控制器内的设定参数值
```

```
/// 无特殊错误代码
```

```
///
```

```
public static int GetSetting(
```

```
    /// [输入]要操作的设备ID
```

```
    int deviceId,
```

```
    /// [输入]目标读取区域
```

```
    byte depth,
```

```
    /// [输入]要读取的特定设定项目
```

```
    LJX8IF_TARGET_SETTING targetSetting,
```

```
    /// [输出]读取到的设定数据
```

```
    ref byte[] data);
```

> 注意点：
> - 设备ID用于指定要操作的控制器，请传入创建控制器连接时指定的数值，详情请参照[创建PC与控制器之间的以太网连接](#CommunicationOpen)
> - depth目标读取区域：0-设定写入区域(WRITE)，1-运行设定区域(RUNNING)，2-保存区域(SAVE)
> 	关于目标读取区域的含义及注意点，请参照[目标设定区域](#目标设定区域)
> - targetSetting为要读取的特定设定项目。
> 	读取单个设定项目时，请参照[发送/接收设定项目详情](#发送/接收设定项目详情)
> 	批量读取环境设定/通用测量设定/检测程序，请参照[批量发送/接收设定](#批量发送/接收设定)
> - data为读取到的设定数据，设定数据的含义，请参照[发送/接收设定项目详情](#发送/接收设定项目详情)

#### '>■ InitializeSetting（初始化设定）

将指定编号的程序恢复到出厂默认设定状态。

```


xxxxxxxxxx
```

```
///
```

```
/// 将指定编号的程序恢复到出厂默认设定状态
```

```
/// 无特殊错误代码
```

```
///
```

```
public static int InitializeSetting(
```

```
    /// [输入]要操作的设备ID
```

```
    int deviceId,
```

```
    /// [输入]要初始化的目标设定区域
```

```
    byte depth,
```

```
    /// [输入]要初始化的程序号,输入范围0~15
```

```
    byte target);
```

> 注意点：
> - 设备ID用于指定要操作的控制器，请传入创建控制器连接时指定的数值，详情请参照[创建PC与控制器之间的以太网连接](#CommunicationOpen)
> - depth指定要初始化的目标设定区域：0-设定写入区域(WRITE)，1-运行设定区域(RUNNING)，2-保存区域(SAVE)
> 	关于目标读取区域的含义及注意点，请参照[目标设定区域](#目标设定区域)
> - depth指定为1、即运行设定区域时，设定写入区域(WRITE)会同时被初始化
> - depth指定为2、即保存区域时，设定写入区域、运行设定区域也会同时被初始化
> - target为要初始化的程序号，请勿传入大于15的数值。

#### '>■ RewriteTemporarySetting（更新设定写入区域）

将设定写入区域的内容生效到运行设定区域或保存区域中。

在写入多项设定参数，为了避免让暂时的设定不匹配导致控制器运行错误，可暂时写入设定写入区域，再将设定从本区域反映到运行设定区域或保存区域。

目标设定区域的含义请参照[目标设定区域](#目标设定区域)，使用过程示例请参照[修改多个设定项目示例](#修改多个设定项目时)。

```


xxxxxxxxxx
```

```
///
```

```
/// 将设定写入区域的内容生效到运行设定区域或保存区域中
```

```
/// 无特殊错误代码
```

```
///
```

```
public static int RewriteTemporarySetting(
```

```
    /// [输入]要操作的设备ID
```

```
    int deviceId,
```

```
    /// [输入]要生效的目标设定区域,可选1/2
```

```
    byte depth,
```

```
    /// [输出]发生设定错误时的详情
```

```
    ref uint error);
```

> 注意点：
> - 设备ID用于指定要操作的控制器，请传入创建控制器连接时指定的数值，详情请参照[创建PC与控制器之间的以太网连接](#CommunicationOpen)
> - depth指定将设定写入区域生效到的目标设定区域：1-运行设定区域(RUNNING)，2-保存区域(SAVE)
> - error为设定写入错误时的设定错误代码，详情请参照[设定错误详情](#设定错误详情)

#### '>■ ReflectSetting（设定写入区域的生效请求）

使用运行设定区域（RUNNING）或保存区域(SAVE)的设定更新设定写入区域（WRITE）的内容。

设定区域的含义请参照[目标设定区域](#目标设定区域)。

```


xxxxxxxxxx
```

```
///
```

```
/// 使用运行设定区域（RUNNING）或保存区域(SAVE)的设定更新设定写入区域（WRITE）的内容
```

```
/// 无特殊错误代码
```

```
///
```

```
public static int ReflectSetting(
```

```
    /// [输入]要操作的设备ID
```

```
    int deviceId,
```

```
    /// [输入]用哪个设定区域的参数覆盖设定写入区域,可选1/2
```

```
    byte depth);
```

> 注意点：
> - 设备ID用于指定要操作的控制器，请传入创建控制器连接时指定的数值，详情请参照[创建PC与控制器之间的以太网连接](#CommunicationOpen)
> - depth指定用哪个设定区域的参数覆盖设定写入区域：1-运行设定区域(RUNNING)，2-保存区域(SAVE)

#### '>■ CheckMemoryAccess（确认设定保存区域的保存处理情况）

确认控制器是否正在写入设定保存区域(SAVE)。

将设定参数写入设定保存区域时，由于写入设定保存区域需要耗费一定时间，函数调用后控制器内部并非立刻完成。

若控制器正在向设定保存区域写入设定时出现电源关闭，检测设定将丢失，控制器也可能会出现故障。

因此、使用[SetSetting](#SetSetting) /[InitializeSetting](#InitializeSetting) /[ReflectSetting](#ReflectSetting)等函数将设定值写入到保存区域后，请务必使用本函数确认写入已完成后再关闭电源。

设定区域的含义请参照[目标设定区域](#目标设定区域)。

```


xxxxxxxxxx
```

```
///
```

```
/// 确认控制器是否正在写入设定保存区域(SAVE)
```

```
/// 无特殊错误代码
```

```
///
```

```
public static int CheckMemoryAccess(
```

```
    /// [输入]要操作的设备ID
```

```
    int deviceId,
```

```
    /// [输出]0:控制器未访问设定写入区域 其他值：控制器正在访问设定写入区域
```

```
    ref byte busy);
```

> 注意点：
> - 设备ID用于指定要操作的控制器，请传入创建控制器连接时指定的数值，详情请参照[创建PC与控制器之间的以太网连接](#CommunicationOpen)
> - busy为当前控制器设定写入区域状态，当pbyBusy不为0时，表示控制器仍在访问设定写入区域，请勿关闭电源。

#### '>■ ChangeActiveProgram（切换活动程序编号）

切换控制器的当前活动程序编号。

```


xxxxxxxxxx
```

```
///
```

```
/// 切换控制器的当前活动程序编号
```

```
/// 无特殊错误代码
```

```
///
```

```
public static int ChangeActiveProgram(
```

```
    /// [输入]要操作的设备ID
```

```
    int deviceId,
```

```
    /// [输入]要切换到的程序编号,请勿指定大于15的数值
```

```
    byte programNo);
```

> 注意点：
> - 设备ID用于指定要操作的控制器，请传入创建控制器连接时指定的数值，详情请参照[创建PC与控制器之间的以太网连接](#CommunicationOpen)
> - programNo 指定与活动程序编号相同编号或无效的程序编号时，仍会执行程序切换 (内存清除等)，但不会切换程序。

#### '>■ GetActiveProgram（获取活动程序编号）

读取控制器的当前活动程序编号。

```


xxxxxxxxxx
```

```
///
```

```
/// 读取控制器的当前活动程序编号
```

```
/// 无特殊错误代码
```

```
///
```

```
public static int GetActiveProgram(
```

```
    /// [输入]要操作的设备ID
```

```
    int deviceId,
```

```
    /// [输出]要切换到的程序编号,请勿指定大于15的数值
```

```
    ref byte programNo);
```

> 注意点：
> - 设备ID用于指定要操作的控制器，请传入创建控制器连接时指定的数值，详情请参照[创建PC与控制器之间的以太网连接](#CommunicationOpen)

#### '>设定的写入处理

在设定的写入处理中用到的函数有如下 4 种。

• [SetSetting](#SetSetting)（发送设定）

• [ReflectSetting](#ReflectSetting)（设定写入区域的生效请求）

• [RewriteTemporarySetting](#RewriteTemporarySetting)（更新设定写入区域）

• [CheckMemoryAccess](#CheckMemoryAccess)（确认保存区域的保存处理情况）


##### '>• 目标设定区域

发送设定时，需要通过 SetSetting 指定 Depth。 Depth 的各选项及对应作用如下所示:


Depth | 作用

Ljx8IfSettingDepth.Write （设定写入区域） | 对动作不产生影响的设定区域 变更多项设定时，为了避免让暂时的设定不匹配导致控制器运行错误，可在本区域改写设定后，再将设定从本区域反映到运行设定区域或保存区域 在不返回错误信息的情况下变更控制器的动作。

Ljx8IfSettingDepth.Running （运行设定区域） | 控制器运行中使用的设定值。 在控制器启动时，被初始化为保存区域的设定值。 但是，该设定区域的设定值在关闭电源后就会丢失。（重新启动时，被初始化为保存区域的设定)

Ljx8IfSettingDepth.Save （保存区域) | 该区域中写入的设定在关闭电源后仍会保存在控制器中。 **写入该区域时需要耗费更多时间**。 （可通过 CheckMemoryAccess 确认是否正在写入该区域。请通过该函数确认写入完成后再关闭电源）


##### '>• 修改多个设定项目时


将多项设定逐项写入设定写入区域（WRITE）变更设定2
SetSetting变更设定1
SetSetting....变更设定n
SetSetting更新设定写入区域
LJX8IF_ReflectSetting
更新RUNNING
> 在写入 RUNNING 或 SAVE 时，会检查设定的匹配性，如果存在不匹配则会返回错误。（有关错误 的详情，请参照 [设定错误详情](#设定错误详情)）因此，变更多项设定时，如果逐项将设定写入 RUNNING （SAVE），如果设定项目引发不匹配，设定将不被反映到控制器。将多项设定写入 WRITE，在编写匹配的设定后，最后将集中反映到控制器。如需将不匹配的 WRITE 设定还原为控 制器内的设定，请使用 [RewriteTemporarySetting](#RewriteTemporarySetting)。注意：1、更新设定写入区域时，设定内将被写入 RUNNING 或SAVE，测量/高速通信将被中断2、设定写入 SAVE 的过程中，请勿关闭控制器的电源。可通过 [CheckMemoryAccess](#CheckMemoryAccess) 确认设定是否已写入3、将变更设定n 的目标写入区域改为 RUNNING，也会获得同样的结果（可以不使用[ReflectSetting](#ReflectSetting)）

##### '>• 仅修改单个设定项目时


修改单个检测设定需要不需要,仅变更运行设定断电后是否保存SetSetting
写入SAVESetSetting
写入RUNNING
> 注意：1、设定写入RUNNING或SAVE时，测量/高速通信将被中断2、在设定写入 SAVE 的过程中，请勿关闭控制器的电源。可通过  [CheckMemoryAccess](#CheckMemoryAccess) 确认设定是否已写入

##### '>• 将本地的设定文件写入控制器时[批量修改设定]
写入控制器设定本地文件读取控制器设定使用SetSetting
写入环境设定使用SetSetting
写入测量通用设定使用SetSetting
写入单个测量程序
程序0~程序15保存环境设定内容
二进制格式保存测量通用设定内容
二进制格式保存测量程序内容
二进制格式使用GetSetting
读取环境设定使用GetSetting
读取测量通用设定使用GetSetting
读取单个测量程序
程序0~程序15
> 注意：1、设定写入RUNNING或SAVE时，测量/高速通信将被中断2、在设定写入 SAVE 的过程中，请勿关闭控制器的电源。可通过 [CheckMemoryAccess](#CheckMemoryAccess)确认设定是否已写入3、mssx文件为LJ-X Navigator专用测量设定文件格式，此处不可用。请使用 [GetSetting](#GetSetting)读出并保存的二进制文件4、读取环境设定/测量通用设定/测量程序时的[目标设定项](#目标设定项)参数，请参照[批量发送/接收设定](#批量发送/接收设定)

#### '>设定错误详情

各类设定中，存在必须满足的匹配性要求。不满足匹配性要求的设定发送、设定写入区域的反映请求指令所反馈的设定错误详情 （error）如下所示。


Error数值 | 错误内容

0x1X000Y00 (*1, *2) | 采样周期超出可设定范围

0x1X000002 (*1) | 批处理点数超出可设定范围

0x1X010000 (*1) | 光量控制上限值＜下限值

0x1X010Y01 (*1, *2) | 测量范围Z 方向超出可设定范围

0x1X010002 (*1) | 测量范围中心X 超出可设定范围

0x1X010003 (*1) | 测量范围中心Z 超出可设定范围

0x1X010004 (*1) | 掩膜设定范围超出可设定范围

0x1X010Y05 (*1, *2) | 曝光时间超出可设定范围

0x1X010Y06 (*1, *2) | 异常反射抑制超出可设定范围

0x1X010Y07 (*1, *2) | 高级设定超出可设定范围

0x1X010Y08 (*1, *2) | 设定范围X 方向超出可设定范围

0x1X010Y09 (*1, *2) | Binning （X）超出可设定范围

0x1X030Y00 (*1, *2) | 半透明体测量功能超出可设定范围

0x1X040Y00 (*1, *2) | 掩膜位置偏离校正超出可设定范围


> *1：X 代表程序编号，存储 0 至 F
> *2：如果Y 为1，则原因在于感测头兼容性


### '>8.2.6 图像获取相关

#### '>■ StartImageReceiving（开始图像高速传输）

与控制器建立高速通信，然后开始获取图像数据。

```


xxxxxxxxxx
```

```
///
```

```
/// 从控制器读取设定内容后初始化PC端缓存并开启图像数据高速传输
```

```
/// 特殊错误代码:
```

```
/// 0x8081：被指定为发送起始位置的数据不存在
```

```
/// 0x80A0：未成功建立高速通信用的TCP连接
```

```
/// 0x80A1：高速通信(图像传输)在执行前已经开始
```

```
/// 0x80A2/0x80A3：未进行高速数据通信(图像传输)的开始前准备
```

```
/// 0X80A4：要发送的目标数据被清除
```

```
/// 0xA000：由于控制器的批处理设定为OFF，无法开始图像数据获取
```

```
/// 0xA001：由于触发方向的间距不确定，无法开始图像数据获取
```

```
/// 0xA002：由于图像行数超过16000行,无法开始图像数据获取
```

```
///
```

```
public static int StartImageReceiving(
```

```
    /// [输入]要操作的设备ID
```

```
    int deviceId,
```

```
    /// [输入]指定用于高速通信的端口编号
```

```
    ushort portNo,
```

```
    /// [输入]指定于图像获取完成时调用的回调函数
```

```
    ImageReceivedCallback callBack,
```

```
    /// [输入]指定DLL内部的轮廓数据接收频率
```

```
    uint receptionProgressStep,
```

```
    /// [输入]轮廓间的触发间距离,以mm为单位
```

```
    double yPitch,
```

```
    /// [输入]是否自动修正编码器触发通过
```

```
    bool interpolateEncoderTriggerPass,
```

```
    /// [输入]是否自动修正图像比例为1:1
```

```
    bool equalizePixcelDensity,
```

```
    /// [输入]指定高速通信线程的用户自定义信息。在调用回调函数时会被使用
```

```
    uint threadId
```

```
);
```

```
///
```

```
/// receptionProgressStep = 10，yPitch = 0
```

```
/// interpolateEncoderTriggerPass = True，equalizePixcelDensity = True
```

```
/// 基于上述参数，开始图像传输
```

```
///
```

```
public static int StartImageReceiving(
```

```
    /// [输入]要操作的设备ID
```

```
    int deviceId,
```

```
    /// [输入]指定用于高速通信的端口编号
```

```
    ushort portNo,
```

```
    /// [输入]指定于图像获取完成时调用的回调函数
```

```
    ImageReceivedCallback callBack,
```

```
    /// [输入]指定高速通信线程的用户自定义信息。在调用回调函数时会被使用
```

```
    uint threadId
```

```
);
```

> 注意点：
> - 设备ID用于指定要操作的控制器，请传入创建控制器连接时指定的数值，详情请参照[创建PC与控制器之间的以太网连接](#CommunicationOpen)
> - 设定内容由从控制器运行设定区域的当前程序处读取，设定读取内容：①批处理状态与点数 ②触发设定 ③触发间间距设定。
> - 控制器批处理设定为OFF时，将返回错误代码0xA000。
> - 如果yPitch指定为0，此时使用控制器内设定的触发间间距。如果此时控制器内触发间间距为OFF，将返回错误代码0xA001。
> - 回调函数接口定义及注意点，请参照[图像接收完成回调函数](#图像接收完成回调函数)
> - 图像获取的流程示例，请参照[图像获取时序图](#图像获取时序图)

#### '>■ StopImageReceiving（停止图像传输）

断开与控制器的高速通信通道。

```


xxxxxxxxxx
```

```
///
```

```
/// 从控制器读取设定内容后初始化PC端缓存并开启图像数据高速传输
```

```
/// 无特殊错误代码
```

```
///
```

```
public static int StopImageReceiving(
```

```
    /// [输入]要操作的设备ID
```

```
    int deviceId);
```

> 注意点：
> - 设备ID用于指定要操作的控制器，请传入创建控制器连接时指定的数值，详情请参照[创建PC与控制器之间的以太网连接](#CommunicationOpen)
> - 若当前正在获取图像，且已经获取了一定数量的轮廓数据，在高速通信的同时将调用回调函数将已收到的数据传递到主程序

#### '>■ GetCurrentImageReceivingState（获取当前图像获取状态）

获取当前图像(轮廓数据)获取的状态。

```


xxxxxxxxxx
```

```
///
```

```
/// 获取当前图像(轮廓数据)获取的状态
```

```
///
```

```
public static Ljx8IfImageReceivingState GetCurrentImageReceivingState(
```

```
    /// [输入]要操作的设备ID
```

```
    int deviceId);
```

> 注意点：
> - 设备ID用于指定要操作的控制器，请传入创建控制器连接时指定的数值，详情请参照[创建PC与控制器之间的以太网连接](#CommunicationOpen)

# 9 错误代码

## '>9.1 通讯库错误代码

### 9.1.1 通用错误返回代码

下列返回代码，将在DLL内部被判断并返回。
 具体来说，返回代码会在与控制器的通信失败，或因通信库的内部问题导致未执行处理时返回。


定义名称 | 数据 （下位2byte） | 发生原因

Ljx8IfRcErr.Ok | 0x0000 | 正常完成

Ljx8IfRcErr.Open | 0x1000 | 开启TCP连接失败

Ljx8IfRcErr.NotOpen | 0x1001 | 未连接到控制器

Ljx8IfRcErr.Send | 0x1002 | 发送指令失败

Ljx8IfRcErr.Receive | 0x1003 | 接收控制器响应时失败

Ljx8IfRcErr.Timeout | 0x1004 | 接收控制器响应时超时

Ljx8IfRcErr.NoMemory | 0x1005 | 保护内存失败

Ljx8IfRcErr.Parameter | 0x1006 | 参数内容错误

Ljx8IfRcErr.RecvFmt | 0x1007 | 控制器响应内容不正确

Ljx8IfRcErr.HiSpeedNoDevice | 0x1009 | 高速通信初始化失败

Ljx8IfRcErr.HiSpeedOpenYet | 0x100A | 高速通信重复初始化

Ljx8IfRcErr.HiSpeedRecvYet | 0x100B | 高速通信发生通信错误

Ljx8IfRcErr.BufferShort | 0x100C | 指针指向的输出缓存长度不足


### 9.1.2 控制器处理错误返回代码

下列错误代码，在DLL与控制器正常通信，但是由于控制器无法处理等原因而发生。


数据 （下位2byte） | 发生原因

0x8031 | 未定义指令（向控制器发送了不支持的指令）

0x8041 | 状态错误（控制器正在发生系统错误等）

0x8042 | 参数错误（指令包含了不正确的参数）

0x8050 | 兼容性错误（由于感测头的版本过低，功能无法使用时）


### '>9.1.3 特殊错误返回代码

下列错误代码，在特定的函数使用时，由于设定参数不正确或控制器设定不符合预期而发生。


数据 （下位2byte） | 发生原因 | 相关函数

0x8080 | 批处理测量的设定为OFF,或虽然在使用多台控制器同步功能 但在“同步主站”中未设定所指定的设备。 | [StartMeasure](#StartMeasure) [StopMeasure](#StopMeasure)

0x80A0 | 由于LASER_ON端子为OFF等原因，未成功进行批处理测量开始处理。 | [StartMeasure](#StartMeasure) [StopMeasure](#StopMeasure)

0x8032 | 指令长度错误 （设定数据未达到规定大小时等） | [SetSetting](#SetSetting)

0x8081 | 被指定为发送起始位置的数据不存在 | [StartImageReceiving](#StartImageReceiving)

0x80A0 | 未成功建立高速通信用的TCP连接 | [StartImageReceiving](#StartImageReceiving)

0x80A1 | 高速通信（图像传输）在执行前已经开始 | [StartImageReceiving](#StartImageReceiving)

0x80A2/0x80A3 | 未进行高速数据通信(图像传输)的开始前准备 | [StartImageReceiving](#StartImageReceiving)

0x80A4 | 发生的目标数据被清除 | [StartImageReceiving](#StartImageReceiving)

0xA000 | 由于控制器的批处理设定为OFF，无法开始图像数据获取 | [StartImageReceiving](#StartImageReceiving)

0xA001 | 由于触发方向的间距不确定，无法开始图像数据获取 | [StartImageReceiving](#StartImageReceiving)

0xA002 | 由于图像总行数超过16000行，无法开始图像数据获取 启用了自动比例修正后，以补正后的图像行数为判断标准 | [StartImageReceiving](#StartImageReceiving)


## '>9.2 控制器错误代码

下列错误代码，为控制器内部的硬件系统错误，并非通讯库的返回代码。
当发生导致测量停止的系统错误时，控制器进入系统错误状态。
具体的系统错误代码可以通过如下两种方式获取：

使用LJ-X Navigator连接到控制器，软件上会显示系统错误提示消息

使用[GetError](#GetError)函数，可以获取当前控制器的系统错误代码


错误代码 | 错误内容 | 发生原因 | 解决方法

0x0020~0x0026 | 这是控制器内存的异常。 请更换控制器后，重新接通电源。 | 控制器内存可能发生故障。 | 请更换控制器后，重新接通电源。 需要对更换的控制器进行检查和维修。 请联系就近的办事处。

0x002A | 这是控制器Ethernet通讯器件的异常。 请更换控制器后，重新接通电源。 | 控制器Ethernet通讯器件可能发生故障。 | 请更换控制器后，重新接通电源。 需要对更换的控制器进行检查和维修。 请联系就近的办事处。

0x002B | 这是控制器内部电路的异常。 请更换控制器后，重新接通电源。 | 控制器内部电路可能发生故障。 | 请更换控制器后，重新接通电源。 需要对更换的控制器进行检查和维修。 请联系就近的办事处。

0x0040~0x0045 0x0060~0x0061 | 这是控制器内部数据的异常。 请更换控制器后，重新接通电源。 | 可能由于电气干扰的影响导致内部数据异常，或控制器内部的器件发生故障。 | 请更换控制器后，重新接通电源。 需要对更换的控制器进行检查和维修。 请联系就近的办事处。

0x0046~0x0047 | 这是控制器的设定数据的异常。 将初始化设定数据后启动。 | 由于设定数据写入过程中的电源OFF或干扰的影响，导致设定数据发生异常。 | 请按照Navigator提示消息操作，排除错误后重启控制器。 系统会恢复到出厂状态。

0x0080 | 连一台感测头也识别不到。请确认感测头的连接后，重新接通电源。 | 可能没有连接任何感测头/线缆断线或感测头故障。 | 请切断电源后后确认感测头线缆的连接状况。 确认后重新接通电源。如果再次显示错误，请联系就近的办事处。

0x0085 | 所连接的感测头的型号与上 一次启动时的型号不同。将初始化设定数据后启动。 | 连接的感测头的型号与上次启动时不同。 | 请按照LJ-X Navigator提示消息操作排除错误，或使用[ClearError](#ClearError)清除错误。错误排除后，程序设定将初始化，系统重启。

0x0086 | 连接的感测头是本机不支持的版本。 | 连接了控制器不支持的感测头，或控制器不支持当前感测头的固件版本。 | 将控制器/感测头分别升级到最新版本固件后，重新接通控制器电源。 若仍然报错，使用[ClearError](#ClearError)清除错误。 如果未能成功清除错误，请联系就近的办事处。

0x0087 | 连接的感测头是本机不支持的版本。 | 感测头固件版本旧，与控制器不兼容的状态。 | 请更换感测头，重新接通电源。 更换的感测头需要检查、修理。请联系就近 的营业所。

0x0120~0x0122 | 这是感测头内存的异常。 请更换感测头后，重新接通电源。 | 感测头内存可能发生故障。 | 请更换感测头后，重新接通电源。 需要对更换的感测头进行检查和维修。 请联系就近的办事处。

0x0123~0x0124 | 这是感测头内部器件的异常。 请更换感测头后，重新接通电源。 | 感测头内部器件可能发生故障。 | 请更换感测头后，重新接通电源。 需要对更换的感测头进行检查和维修。 请联系就近的办事处。

0x0140~0x0142 0x0160 | 这是感测头内存的异常。 请更换感测头后，重新接通电源。 | 可能由于电气干扰的影响导致感测头数据异常，或控制器内部的器件发生故障。 | 请更换感测头后，重新接通电源。 需要对更换的感测头进行检查和维修。 请联系就近的办事处。

0x0180 | 感测头的初始化失败。请确认连接并更换电缆后，重新接通电源。如果更换电缆仍得不到改善，则请更换感测头后，重新接通电源。 | 可能感测头线缆断线，或感测头内部的部件故障。 | 请确认更换感测头-控制器线缆并确认连接情况后，重新接通电源。 如果更换电缆后未改善，请更换感测头后，重新接通电源。 需要对更换的感测头进行检查和维修。请联系就近的办事处

0x0181~0x0182 | 与感测头的通信失败。请确认连接并更换电缆后，重新接通电源。如果更换电缆仍得不到改善，则请更换感测头后，重新接通电源。 | 可能感测头线缆断线，或感测头内部的部件故障。 | 请确认更换感测头-控制器线缆并确认连接情况后，重新接通电源。 如果更换电缆后未改善，请更换感测头后，重新接通电源。 需要对更换的感测头进行检查和维修。请联系就近的办事处

0x0183 | 检测到感测头的电源瞬间切 断。 将重新启动系统。 | 感测头可能受到强烈干扰。 | 请采取适当措施避免感测头受到强烈干扰， 然后重新接通电源。


# '>10 附录

## '>10.1 发送/接收设定

通过发送设定[SetSetting](#SetSetting)、接收设定[GetSetting](#GetSetting)，分别对各项目发送/接收设定。
（各项目指的是环境设定 / 测量通用设定 / 程序 0 至 15 的各项设定参数）
如需批量进行环境设定、测量通用设定或各程序设定的发送/接收，而非单个设定参数的设定发送/接收，请参照[批量发送/接收设定](#批量发送/接收设定)。

Type分类如下：


 | 环境设定 | 测量通用设定 | 程序0~15

Type值 | 0x01 | 0x02 | 0x10~0x1F


当设定对象为环境设定、测量通用设定时，Category固定使用0

当设定对象为检测程序时，Category分类如下：


 | 触发设定 | 拍摄设定 | 轮廓

Category值 | 0x00 | 0x01 | 0x02


## '>10.2 批量发送/接收设定

将Category 指定为 0xFF，即可发送/接收环境设定 / 测量通用设定 / 各程序的全部设定项目。


发送/接收对象 | Type | Category | Item | Target1~4 | 设定数据长度

环境设定 | 0x01 | 0xFF | 0x00 | 0x00 | 60 byte

测量通用设定 | 0x02 | 0xFF | 0x00 | 0x00 | 20 byte

程序0 | 0x10 | 0xFF | 0x00 | 0x00 | 10,980 byte

程序1 | 0x11 | 0xFF | 0x00 | 0x00 | 10,980 byte

... | ... | ... | ... | ... | ....

程序15 | 0x1F | 0xFF | 0x00 | 0x00 | 10,980 byte


## '>10.3 发送/接收设定项目详情

### 10.3.1 环境设定 设定项目列表

对于环境设定的设定项目，Type固定为0x01，Category固定为0x00，各项目的Item和Target如下：


设定项目 | Item | Target1-4 | 设定数据长度 | 补充说明

设备名称 | 0x00 | 0x00 | 32 byte | 最多 32 个字符。末尾不带 0 SHIFT-JIS

下次接通电源时动作 | 0x01 | 0x00 | 1 byte | 0：BOOTP→IP地址固定 1：IP地址固定 2：BOOTP

高速通信带宽限制 | 0x02 | 0x00 | 1 byte | 0：OFF 1：500Mbps 2：200Mbps 3：100Mbps

高速通信时 MTU | 0x03 | 0x00 | 2 byte | 1,500~9,216

IP地址 | 0x04 | 0x00 | 4 byte | [IP地址规则^※1^](#环境设定注意点)

子网掩码 | 0x05 | 0x00 | 4 byte | [子网掩码规则^※2^](#环境设定注意点)

默认网关 | 0x06 | 0x00 | 4 byte | [默认网关规则^※3^](#环境设定注意点)

TCP指令端口号 | 0x07 | 0x00 | 2 byte | 1~65,535，不可以与高速端口相同

TCP高速端口号 | 0x08 | 0x00 | 2 byte | 1~65,535，不可以与指令端口相同


> 注意点：
> - 下述IP地址视为不正确的IP地址：0.0.0.0、224.0.0.0 至 255.255.255.255
> - 下述地址将被视作不正确的子网掩码：0.0.0.0、255.255.255.255或从首位起， “1” 不连续
> 例如：255.255.255.64，二进制值时：11111111.11111111.11111111.01000000,由于“1”不连续，视为不正确
> - 下述地址将被视作不正确的默认网关：224.0.0.0 至 255.255.255.255


### 10.3.2 修改/读取测量通用设定 设定项目列表

对于测量通用设定的设定项目，Type固定为0x02，Category固定为0x00，各项目的Item和Target如下：


设定项目 | Item | Target1-4 | 设定数据长度 | 补充说明

内存分配 | 0x01 | 0x00 | 1 byte | 0：双缓存 1：全部区域

内存FULL时的动作 | 0x02 | 0x00 | 1 byte | 0：覆盖 1：停止

并列拍摄 | 0x03 | 0x00 | 1 byte | 0：无效 1：有效[^※1^](#测量通用设定注意点)

TRG最短输入时间 | 0x06 | 0x00 | 2 byte | 0：7us 1：10us 2：20us 3：50us 4：100us 5：200us 6：500us 7：1ms

编码器最短输入时间 | 0x07 | 0x00 | 4 byte | 0：120ns 1：150ns 2：250ns 3：500us 4：1us 5：2us 6：5us 7：10us 8：20us

控制端子最短输入时间 | 0x08 | 0x00 | 4 byte | 0：250us 1:1ms

亮度输出 | 0x0B | 0x00 | 4 byte | 0：仅高度数据[^※2^](#测量通用设定注意点) 1:高度 + 亮度数据[^※3^](#测量通用设定注意点)


> 注意点：
> - 使用LJ-X感测头时，不能设置并列排列
> - LJ-V***B感测头亮度输出始终有效，无法修改
> - LJ-V感测头无法进行亮度输出


### 10.3.3 各程序内的设定时 设定项目列表

对于程序内的设定项目，Type根据程序号不同依次为0x10~0x1F


- 程序0对应的Type为0x10

- 程序1对应的Type为0x11

- 以此类推，程序15对应的Type为0x1F


#### ■ 触发设定内的设定项目

触发设定内的Category固定为0x00


设定项目 | Item | Target1-4 | 设定数据长度 | 补充说明

触发模式 | 0x01 | 0x00 | 1 byte | 0：连续触发 1：外部触发 2：编码器触发

采样周期 | 0x02 | 0x00 | 1 byte | [采样周期设定参数表](#采样周期设定参数表)

批处理测量 | 0x03 | 0x00 | 1 byte | 0：批处理OFF 1：批处理ON

触发间间距 | 0x04 | 0x00 | 1 byte | 0：不使用 1：使用

触发间间距数值 | 0x05 | 0x00 | 4 byte | 1 ~ 500,000 （单位：0.1um，即0.1um-50mm）

防止相互干扰 | 0x06 | 0x00 | 2 byte | [防止相互干扰设定值详情](#防止相互干扰设定值备注) 支持控制器固件版本1.02.00或更高

编码器输入模式 | 0x07 | 0x00 | 1 byte | 0：1相1递增 1：2相1递增 2：2相2递增 3：2相4递增

编码器细化 | 0x08 | 0x00 | 1 byte | 0：OFF 1：ON

编码器细化点数 | 0x09 | 0x00 | 2 byte | 2 ~ 1,000

批处理点数 | 0x0A | 0x00 | 2 byte | 50 ~ 60,000

多台控制器同步 | 0x0B | 0x00 | 1 byte | 0：同步OFF 1：主站同步 2：从站同步


##### '>各系列感测头采样周期的设置值


设定值 | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10

LJ-X | 10HZ | 20HZ | 50HZ | 100HZ | 200HZ | 500HZ | 1kHz | 2kHz | 4kHz | 8kHz | 16kHz

LJ-V | 10HZ | 20HZ | 50HZ | 100HZ | 200HZ | 500HZ | 1kHz | 2kHz | 4kHz | 4.13kHz | 8kHz

LJ-V*B | 10HZ | 20HZ | 50HZ | 100HZ | 200HZ | 500HZ | 1kHz | 2kHz | 4kHz | 4.13kHz | 8kHz


设定值 | 11 | 12 | 13 | 14 | 15 | 16 | 17 | 18 | 19

LJ-X | 1.5kHz | 2.5kHz | 3kHz | 3.5kHz | 4.5kHz | 5kHz | 6kHz | 7kHz | 12kHz

LJ-V | 16kHz | 32kHz | 64kHz | 不支持 | 不支持 | 不支持 | 不支持 | 不支持 | 不支持

LJ-V*B | 不支持 | 不支持 | 不支持 | 不支持 | 不支持 | 不支持 | 不支持 | 不支持 | 不支持


##### '>防止相互干扰设定值


设定数据数组 | byte0 | byte1

设定值 | 0：防止相互干扰OFF 1：防止相互干扰AB-ON 2：防止相互干扰ABC-ON | 0：与主站同时发光(A) 1：与主站交替发光(B) 2：与主站交替发光(C)


#### ■ 拍摄设定内的设定项目

触发设定内的Category固定为0x01


设定项目 | Item | Target1~4 | 设定数据长度 | 补充说明

Binning | 0x01 | 0x00 | 1 byte | 0：Binning OFF 1：Binning ON ~使用LJ-X传感头时无效~

X方向测量范围 | 0x02 | 0x00 | 4 byte | [X方向测量范围设定值详情](#X方向测量范围备注)

Z方向测量范围 | 0x03 | 0x00 | 8 byte | [Z方向测量范围设定值详情](#Z方向测量范围备注)

动态范围 | 0x05 | 0x00 | 1 byte | 对LJ-X: 1~9 对LJ-V： 0：高精度 1：高动态范围1 2：高动态范围2 3：高动态范围3

曝光时间 | 0x06 | 0x00 | 1 byte | 0：15us 1:30us 2:60us 3:120us 4：240us 5:480us 6:960us 更多请参照[曝光时间设置值详情](#曝光时间设定值详情)

曝光模式 | 0x07 | 0x00 | 1 byte | 0：标准 1：多重发光(合成) 2：多重发光(光量最佳化)

多重发光(光量最佳化)详情 | 0x08 | 0x00 | 1 byte | 0：2次 1：4次

多重发光(合成)详情 | 0x09 | 0x00 | 2 byte | 0：3次 1：5次

屏蔽设定 | 0x0A | Target1： 0：上屏蔽1 1：上屏蔽2 2:上屏蔽3 3：下屏蔽1 4：下屏蔽2 5:下屏蔽3 Target2~4：0x00 | 16 byte | 通过指定Target1的数值可以编辑各个屏蔽区域 关于设定数据详情，请参照[屏蔽设定数据数组详情](#屏蔽设定数据数组详情)

光量控制 控制模式 | 0x0B | 0x00 | 1 byte | 0：AUTO 1：MUNUAL

光量控制 上限值 | 0x0C | 0x00 | 1 byte | 1~99

光量控制 下限值 | 0x0D | 0x00 | 1 byte | 1~99

光量控制 对象区域 | 0x0E | 0x00 | 4 byte | byte0~1：对象区域起始：0 ~ 1000 byte2~3：对象区域结束：0 ~ 1000 (单位：0.1%，即0.0~100.0%)

峰值检测灵敏度 | 0x0F | 0x00 | 1 byte | 1 ~ 5

无效数据插补点数 | 0x10 | 0x00 | 1 byte | 0 ~ 255

峰值选择 | 0x11 | 0x00 | 1 byte | 0：标准 1：NEAR 2：FAR 对LJ-X 3~5:作为无效数据 对LJ-V 3：消除X多重反射 4：消除Y多重反射 5：作为无效数据

峰值宽度过滤器 | 0x12 | 0x00 | 2 byte | byte0： 0:过滤器OFF 1：过滤器ON byte1：对LJ-X 过滤器强度：1~5 对LJ-V 固定为0

异常反射去除过滤器 | 0x14 | 0x00 | 2 byte | byte0： 0:过滤器OFF 1：过滤器ON byte1：过滤器强度 1~3 使用LJ-V时，此设定项无效


##### '>X方向测量范围设定值


设定数据数组 | byte0 | byte1 | byte2~3

设定值 | X方向测量范围 对于 LJ-X 0：FULL 1：3/4 2：1/2 3：1/4 对于 LJ-V 0：FULL 1：MIDDLE 2：SMALL | 预留位 固定为0 | X方向测量范围中心 对于LJ-X 0~1000(以0.1%为单位、即0.0%-100.0%) 对于LJ-V 预留位，固定为0


##### '>Z方向测量范围设定值


数据数组 | byte0 | byte1 | byte2~3 | byte4 | byte5 | byte6~7

设定值 | Z方向测量范围 对于LJ-X：参照下表 对于LJ-V 0：FULL 1：MIDDLE 2：SMALL | 预留位 固定为0 | Z方向测量范围中心 对于LJ-X：0~1000 (以0.1%为单位、即0.0%-100.0%) 对于LJ-V：预留位，固定为0 | ※仅连接LJ-X8400时有效 0：Z范围扩展OFF 1：Z范围扩展ON | ※仅LJ-X8080/8200/8300时有效 0：BinningZ ON 1：BinningZ OFF | 预留位 固定为0


##### LJ-X感测头Z方向测量范围大小设定值：


Z方向测量范围 | FULL | 1/1.5 | 1/2 | 1/2.5 | 1/3 | 1/3.5 | 1/4 | 1/4.5 | 1/5 | 1/6

LJ-X8020/8060 LJ-X8080/8200/8300(BinningZ ON) LJ-X8400(扩展范围OFF) | 0 | 6 | 1 | 7 | 8 | 9 | 2 | 10 | 11 | 12

LJ-X8080/8200/8300(BinningZ OFF) LJ-X8400(扩展范围ON) LJ-X8900 | 0 | × | 1 | × | 8 | × | 2 | × | 11 | 12


Z方向测量范围 | 1/7 | 1/8 | 1/9 | 1/10 | 1/12 | 1/14 | 1/16 | 1/24 | 1/32

LJ-X8020/8060 LJ-X8080/8200/8300(BinningZ ON) LJ-X8400(扩展范围OFF) | 13 | 3 | × | × | 16 | × | 4 | × | ×

LJ-X8080/8200/8300(BinningZ OFF) LJ-X8400(扩展范围ON) LJ-X8900 | 13 | 3 | 14 | 15 | 16 | 17 | 4 | 18 | 5


##### '>曝光时间设定值


曝光时间 | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 11 | 12 | 13 | 14 | 15

LJ-X | 15us | 30us | 60us | 120us | 240us | 480us | 960us | 1700us | 4.8ms | 9.6ms | 80us | 160us | 210us | 320us | 380us | 640us

LJ-V | 15us | 30us | 60us | 120us | 240us | 480us | 960us | 1920us | 5ms | 10ms | × | × | × | × | × | ×


屏蔽设定数据数组详情如下：


设定数据数组 | byte0 | byte1~3 | byte4~5 | byte6~7 | byte8~9 | byte10~11 | byte12~13 | byte14~15

设定值 | 0：无效 1：矩形 2：三角形 | 预留位 固定为0 | X坐标1：0~1000 单位：0.1% 即：0.0~100.0% | Z坐标1：0~1000 单位：0.1% 即：0.0~100.0% | X坐标2：0~1000 单位：0.1% 即：0.0~100.0% | Z坐标2：0~1000 单位：0.1% 即：0.0~100.0% | X坐标3：0~1000 单位：0.1% 即：0.0~100.0% 矩形时无需设置 | Z坐标3：0~1000 单位：0.1% 即：0.0~100.0% 矩形时无需设置


#### ■ 轮廓设定内的设定项目

触发设定内的Category固定为0x02


设定项目 | Item | Target1~4 | 设定数据长度 | 补充说明

- | 0x01 | 0x00 | 1 byte |

间隔(X轴) | 0x02 | 0x00 | 1 byte | 0：间隔OFF 1：1/2 2：1/4

死角数据插补 | 0x05 | 0x00 | 1 byte | 0：不进行插补 1：直线插补 2：垂直插补

反转X | 0x06 | 0x00 | 1 byte | 0：反转OFF 1：反转ON

反转Z | 0x07 | 0x00 | 1 byte | 0：反转OFF 1：反转ON

位移X | 0x08 | 0x00 | 4 byte | 任意int32数值，单位为0.01um 例：1.01mm = 101000

位移Z | 0x09 | 0x00 | 4 byte | 任意int32数值，单位为0.01um 例：2.01mm = 201000

中位数(X轴) | 0x0A | 0x00 | 1 byte | 0：OFF 1：3点 2:5点 3:7点 4:9点 5:17点 6:25点 7:33点

平滑(X轴) | 0x0B | 0x00 | 2 byte | byte0 0:1次 1:2次 2:4次 3:8次 4:16次 5:32次 6:64次 byte1 对LJ-X 0：形状保持OFF 1：形状保持ON 对LJ-V，无形状保持功能，byte1始终为0

中位数(时间轴) | 0x0C | 0x00 | 1 byte | 0：OFF 1：3点 2:5点 3:7点 4:9点

平均(时间轴) | 0x0D | 0x00 | 1 byte | 0：1回 1：2回 2:4回 3:8回 4:16回 5:32回 6:64回 7:128回 8:256回

无效数据处理(时间轴) | 0x0E | 0x00 | 2 byte | byte0：处理次数 0~255 byte1：恢复次数 0~255

倾斜补正 | 0x0F | 0x00 | 28 byte | 关于设定数据详情，请参照[倾斜补正设定数据数组详情](#倾斜补正设定数据数组详情)

高度补正 | 0x10 | 0x00 | 28 byte | 关于设定数据详情，请参照[高度补正设定数据数组详情](#高度补正设定数据数组详情)


##### '>倾斜补正设定数据数组详情


设定数据数组 | byte0 | byte1~3 | byte4 | byte5~7 | byte8~11 | byte12~15 | byte16~19 | byte20~23 | byte24~25 | byte26~27

LJ-X | 0：补正无效 1：补正有效 | 预留位 固定为0 | 0：区域2无效 1：区域2有效 | 预留位 固定为0 | 区域1 起始位置^※1^ 单位：0.01mm | 区域1 结束位置^※1^ 单位：0.01mm | 区域2 起始位置^※1^ 单位：0.01mm | 区域2 结束位置^※1^ 单位：0.01mm | 补正后角度^※2^ 单位：0.01° -45.00°~45.00° | 补正角度^※2^ 单位：0.01° -45.00°~45.00°


> 注意点：
> - 区域1/2的起始/结束位置设定值单位为0.01mm,数值类型为int32，可以取对应感测头有效测量范围内的任意数值
> 例如：5.01mm时，设定值为501000
> - 补正后角度/补正角度值单位为0.01°，数值类型为short，有效范围为-45.00°~45.00°，即-4500 ~ 4500
> 例如：-0.15°时，设定值为-15

##### '>高度补正设定数据数组详情


设定数据数组 | byte0 | byte1~3 | byte4~7 | byte8~11 | byte12~15 | byte16~19 | byte20~23 | byte24~27

LJ-X | 0：补正无效 1：补正有效 | 预留位 固定为0 | 区域1 起始位置^※1^ 单位：0.01mm | 区域1 结束位置^※1^ 单位：0.01mm | 区域2 起始位置^※1^ 单位：0.01mm | 区域2 结束位置^※1^ 单位：0.01mm | 补正后高度^※2^ 单位：0.01mm | 补正倍率^※3^ 0~131072


> 注意点：
> - 区域1/2的起始/结束位置设定值的单位为0.01mm,数值类型为int32，可以取对应感测头有效测量范围内的任意数值
> 例如：5.01mm时，设定值为501000
> - 补正后高度值设定值的单位为0.01mm，数值类型为int32，有效范围为0~999.999mm，即0 ~ 99,999,900
> - 补正倍率设定值的数值类型为int32，设定值为实际值 * 65536，将设定值除以65536后，即可得到实际的高度补正倍率有效范围为0.0 ~ 2.0倍，即设定值的有效范围为0 ~ 131072
> 例1：当LJ-X Navigator显示的补正倍率为1.5倍时，通过[GetSetting](#GetSetting)取得的设定值为 1.5 * 65536 = 98304
> 例2：希望将补正倍率设置为1.05倍时，需将设定值指定为 1.05 * 65536 ≈ 68813（由于设定值为整数，因此取整之后作为设定值）
