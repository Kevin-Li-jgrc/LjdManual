[1 软件使用许可协议条款](#1-软件使用许可协议条款)[2 前言](#2-前言)[3 运行环境](#3-运行环境)[3.1 硬件规格与系统要求](#31-硬件规格与系统要求)[3.2 基本运行环境](#32-基本运行环境)[Microsoft C/C++ Runtime Library](#microsoft-cc++-runtime-library)[Microsoft .NET Framework](#microsoft-net-framework)[CodeMeterRuntime](#codemeterruntime)[4 文件构成](#4-文件构成)[5 嵌入方法](#5-嵌入方法)[6 图像结构定义](#6-图像结构定义)[6.1 高度图像结构体定义](#61-高度图像结构体定义)[6.1 亮度图像结构体定义](#61-亮度图像结构体定义)[7 图像接收完成时的回调函数](#7-图像接收完成时的回调函数)[7.1 图像接收完成回调函数委托定义](#71-图像接收完成回调函数委托定义)[7.2 回调函数通讯状态指示](#72-回调函数通讯状态指示)[7.3 回调函数调用详情](#73-回调函数调用详情)[7.4 图像获取时序图](#74-图像获取时序图)[8 函数](#8-函数)[命名空间/类名称](#命名空间类名称)[8.1 函数一览](#81-函数一览)[8.1.1 对DLL的操作](#811-对dll的操作)[8.1.2 建立/断开与感测头之间的Ethernet连接](#812-建立断开与感测头之间的ethernet连接)[8.1.3 硬件控制相关](#813-硬件控制相关)[8.1.4 测量控制相关](#814-测量控制相关)[8.1.5 变更/读取设定相关](#815-变更读取设定相关)[8.1.6 图像获取相关](#816-图像获取相关)[8.2 函数说明](#82-函数说明)[8.2.1  对DLL的操作](#821--对dll的操作)[■ Initialize（DLL初始化）](#■-initializedll初始化)[■ Finalize（DLL处理终止）](#■-finalizedll处理终止)[8.2.2 建立/断开与感测头之间的Ethernet连接](#822-建立断开与感测头之间的ethernet连接)[■ CommunicationOpen（创建PC与感测头的以太网连接）](#■-communicationopen创建pc与感测头的以太网连接-)[■ CommunicationClose（断开PC与感测头间的以太网连接）](#■-communicationclose断开pc与感测头间的以太网连接-)[8.2.3 硬件控制相关](#823-硬件控制相关)[■ ControlLaser（控制激光ON/OFF）](#■-controllaser控制激光onoff-)[■ GetError（获取感测头系统错误）](#■-geterror获取感测头系统错误-)[■ ClearError（解除感测头系统错误）](#■-clearerror解除感测头系统错误-)[■ GetAttentionStatus（获取SCMD_READY / TRG_READY / MEM_FULL的状态）](#■-getattentionstatus获取scmdready--trgready--memfull的状态-)[8.2.4 硬件控制相关](#824-硬件控制相关)[■ StartMeasure（发送触发信号）](#■-startmeasure发送触发信号-)[■ ClearMemory（清除感测头内存）](#■-clearmemory清除感测头内存)[8.2.5 写入/读取设定相关](#825-写入读取设定相关)[指定要执行写入/读取的目标设定项目](#指定要执行写入读取的目标设定项目)[■ SetSetting（发送设定）](#■-setsetting发送设定)[■ GetSetting（获取设定）](#■-getsetting获取设定)[■ InitializeSetting（初始化设定）](#■-initializesetting初始化设定)[■ RewriteTemporarySetting（更新设定写入区域）](#■-rewritetemporarysetting更新设定写入区域)[■ ReflectSetting（设定写入区域的生效请求）](#■-reflectsetting设定写入区域的生效请求)[■ CheckMemoryAccess（确认设定保存区域的保存处理情况）](#■-checkmemoryaccess确认设定保存区域的保存处理情况)[■ ChangeActiveProgram（切换活动程序编号）](#■-changeactiveprogram切换活动程序编号)[■ GetActiveProgram（获取活动程序编号）](#■-getactiveprogram获取活动程序编号)[设定的写入处理](#设定的写入处理)[• 目标设定区域](#-目标设定区域)[• 修改多个设定项目时](#-修改多个设定项目时)[• 仅修改单个设定项目时](#-仅修改单个设定项目时)[• 将本地的设定文件写入感测头时[批量修改设定]](#-将本地的设定文件写入感测头时批量修改设定)[设定错误详情](#设定错误详情)[8.2.6 图像获取相关](#826-图像获取相关)[■ StartImageReceiving（开始图像高速传输）](#■-startimagereceiving开始图像高速传输)[■ StopImageReceiving（停止图像传输）](#■-stopimagereceiving停止图像传输)[9 错误代码](#9-错误代码)[9.1 通讯库错误代码](#91-通讯库错误代码)[9.1.1 通用错误返回代码](#911-通用错误返回代码)[9.1.2 感测头处理错误返回代码](#912-感测头处理错误返回代码)[9.1.3 特殊错误返回代码](#913-特殊错误返回代码-)[9.2 感测头错误代码](#92-感测头错误代码)[10 附录](#10-附录)[10.1 发送/接收设定](#101-发送接收设定)[10.2 批量发送/接收设定](#102-批量发送接收设定)[10.3 发送/接收设定项目详情](#103-发送接收设定项目详情)[10.3.1 环境设定 设定项目列表](#1031-环境设定-设定项目列表)[10.3.2 修改/读取测量通用设定 设定项目列表](#1032-修改读取测量通用设定-设定项目列表)[10.3.3 各程序内的设定时 设定项目列表](#1033-各程序内的设定时-设定项目列表)[■ 驱动设定、触发设定内的设定项目](#■-驱动设定触发设定内的设定项目)[■ 拍摄设定内的设定项目](#■-拍摄设定内的设定项目)[Y方向测量范围设定值](#y方向测量范围设定值)[Z方向测量范围设定值检测对象选择详细设定值](#z方向测量范围设定值检测对象选择详细设定值)[检测对象选择详细设定值](#检测对象选择详细设定值)[■ PC图像过滤器的设定项目](#■-pc图像过滤器的设定项目)[去除凸起状干扰详情](#去除凸起状干扰详情)[抑制无效像素详情](#抑制无效像素详情)


# '>1 软件使用许可协议条款

对LJ Developer(以下简称“本软件”)的使用，以用户接受下列软件使用许可协议（以下称“本协议”）为前提条件。若用户将本软件的全部或部分安装或复制到设备和计算机，或使用安装于设备和计算机上的本软件，则视同用户已接受本协议的所有条款，本协议成立生效。

第1条 (使用权的承诺)
以用户遵守本协议为条件，KEYENCE CORPORATION(以下简称“本公司”)承诺用户的非独占性使用权。

第2条 (复制限制)
仅在用户需要备份本软件或需要向前条所规定的第三者进行转让时，可对本软件进行复制。

第3条 (禁止事项)
禁止用户对本软件进行以下行为。
a. 变更或增加本软件的部分或全部功能的修改行为。但是，有本公司提供更新程序或安装添加功能等，本公司明确授权的行为除外。
b. 反向编译或反向装配等，解读本软件的所有逆向工程行为。
c. 将本软件对第三者进行转卖、转让、重新分发、使用授权、租赁、出租等行为。但事先得到本公司认可的情况除外。

第4条（版权等）
本软件及本软件手册相关的版权等知识产权归本公司所有。

第5条（免责）
对于因使用本软件而对用户或第三者造成的损害，本公司概不负责。

第6条（终止合同）


- 用户通过废弃本软件及其复制物等手段停止使用本软件之时起，本协议自动终止。

- 若用户违反本协议任一条款，本公司可单方面解除本协议。此时，应立即废弃本软件及其复制物或将其返还至本公司。

- 若因用户违反本协议而对本公司造成损害，用户须赔偿本公司损失。


第7条（准据法和管辖权）
本协议基于日本国法律而生效。此外，关于本合同的一切纠纷将交由作为专属协议管辖法院的大阪地方法院予以裁决。


# '>2 前言

LJ Developer通讯库，适用于LJ Developer从LJ-S8000感测头获取图像数据及其他处理时必要的感测头信息、设定参数信息。


# '>3 运行环境

## '>3.1 硬件规格与系统要求


项目 | 必要条件

**操作系统** | Microsoft Windows 11 Pro (64bit)、Microsoft Windows 10 Pro (64bit)

**CPU** | 基于intel®CoreTM i5 处理器或更高

**内存容量** | 16 GB 以上

**接口** | 配备下列任意一项。

**开发环境** | Microsoft Visual Studio 2017 C#7.3 或更高版本


・不保证连接到 LAN 和使用路由器连接时的操作状况。

・必要的硬件环境很大程度取决于作为处理对象的图像尺寸和所使用的处理功能。
・Windows是美国Microsoft Corporation在美国及其他国家的注册商标或商标。

## '>3.2 基本运行环境

为了确保通信库的正确运行，必须准备如下环境：

### Microsoft C/C++ Runtime Library

Microsoft C Runtime Library。
请运行并安装vcredist_x64.exe。

### Microsoft .NET Framework

LjDevMeasure.dll基于.NET Framework 4.7.2开发。
请运行并安装ndp472-kb4054530-x86-x64-allos-enu.exe。

### CodeMeterRuntime

请运行并安装CodeMeterRuntime.exe。

此外，请将cpsevents-6002427文件夹放置在与执行文件相同的文件夹中。

cpsevents-6002427文件夹存储在C:\Program Files\KEYENCE \LJ Developer\lib\x64中。


# '>4 文件构成

运行测量库所需的文件（LjDevCommunication.dll、LJS8_IF.dll、LjDevCommon.dll、LjDevCommon.Core.dll）存储在如下位置

C:\Program Files\KEYENCE \LJ Developer\lib\x64


# '>5 嵌入方法

请将如下文件与可执行应用程序放置在同一文件夹内


- LJS8_IF.dll

- LjDevCommunication.dll

- LjDevCommon.dll

- LjDevCommon.Core.dll


# '>6 图像结构定义

从感测头取得的数据为高度、浓淡与附加信息混合的多行轮廓数据。

为了便于后续图像处理，轮廓数据在传输到用户应用程序前转换为便于处理的图像结构。

注意点:


- LJ Developer提供的测量处理，以XY等比例（CoefficientX = CoefficientY）图像的处理为前提。

- 在开始图像高速传输（StartImageReceiving)时，如果指定参数equalizePixcelDensity为true，则图像数据将自动修正为XY等比例（CoefficientX = CoefficientY)后传回。


## '>6.1 高度图像结构体定义

高度图像结构体的公开对象定义如下。

```


/// 高度图像结构体公开对象
```

```
public struct LHeightImage
```

```
    {
```

```
     /// 高度图像的像素数值数组，数组长度为XSize * YSize
```

```
        public ushort[] Source;
```

```
     /// 高度图像的X方向点数
```

```
        public int XSize;
```

```
     /// 高度图像的行数
```

```
        public int YSize;
```

```
     /// X方向的比例系数,即X方向像素点之间的真实距离,单位为mm
```

```
        public double CoefficientX;
```

```
     /// Y方向的比例系数,即轮廓与轮廓之间的真实触发间距,单位为mm
```

```
        public double CoefficientY;
```

```
     /// Z方向的比例系数,单位为mm
```

```
        public double CoefficientZ;
```

```
    }
```
以4 * 4的图像为例，示意图如下：


![./ImageDetail.svg](ImageSample) | 如左侧示意图 XSize为图像的宽度，与单条轮廓数据的点数一致。 YSize为图像的行数，即图像中包含多少行轮廓。 Source为对应的像素1维数组，左侧图示中的数字为每个像素值在数组中的序号，数组长度为XSize * YSize。 CoefficientX是图像上的1个像素对应的实际真实距离，单位是mm。 CoefficientY是图像上行与行之间对应的实际真实距离，单位是mm。


各型号感测头在默认设定下的比例系数如下（单位：mm）：


LJ-S感测头 | LJ-S015 | LJ-S025 | LJ-S040 | LJ-S080

CoefficientX | 0.005 | 0.008 | 0.0125 | 0.025

CoefficientZ | 0.0004 | 0.001 | 0.0012 | 0.002


## '>6.1 亮度图像结构体定义

亮度图像结构体的公开对象定义如下。

```


xxxxxxxxxx
```

```
/// 亮度图像结构体公开对象
```

```
public struct LGrayImage
```

```
    {
```

```
        /// 亮度图像的像素数值数组，数组长度为XSize * YSize
```

```
        public byte[] Source;
```

```
     /// 高度图像的X方向点数
```

```
        public int XSize;
```

```
     /// 高度图像的行数
```

```
        public int YSize;
```

```
     /// X方向的比例系数,即X方向像素点之间的真实距离,单位为mm
```

```
        public double CoefficientX;
```

```
     /// Y方向的比例系数,即轮廓与轮廓之间的真实触发间距,单位为mm
```

```
        public double CoefficientY;
```

```
    }
```
亮度图像结构体公开成员与高度图像类似，各成员请参照高度图像结构体公开成员。


# '>7 图像接收完成时的回调函数

感测头向PC实时传输轮廓数据，当PC从感测头取得指定数量的轮廓数据，将轮廓数据转换成图像。

从开始扫描图像到数据传输结束图像创建完毕之间存在时间间隔。

为了避免取图过程应用程序线程堵塞，采用异步模式获取轮廓，图像创建完成时，调用回调函数通知主程序。

图像完成回调函数的详情如下所示。用于 StartImageReceiving指令。

## '>7.1 图像接收完成回调函数委托定义

```


xxxxxxxxxx
```

```
/// 图像接收完成回调函数定义
```

```
/// 在图像获取完成后或通信状态异常时进行调用，用于通知主程序图像获取状态。
```

```
/// 该回调函数由图像获取线程调用，与主程序线程处于不同线程。
```

```
/// 由于回调函数所处线程为通讯线程，回调函数运行时间过长时，可能造成通讯异常。
```

```
/// 因此，不可在回调函数内直接处理图像数据。
```

```
///
```

```
public delegate void ImageReceivedCallback(
```

```
    /// [输出]获取到的高度图像
```

```
    LHeightImage heightImage,
```

```
    /// [输出]获取到的亮度图像
```

```
    LGrayImage grayImage,
```

```
    /// [输出]通讯状态指示
```

```
    ReceivedStatus notify);
```

## '>7.2 回调函数通讯状态指示
回调函数返回时，将同时返回当前通讯状态的指示值（ReceivedStatus），定义如下：


定义 | 含义

ImageReceived | 停止连续发送（通过命令停止）

SettingChanged | 停止连续发送（由于设定变更自动停止）

ProgramNoChanged | 停止连续发送（由于程序切换自动停止）

CommunicationInterrupted | 被外部强制中断通信

MemoryCleared | 由于清除内存，通讯中断

InvalidDataReceived | 接收奇偶校验错误

HeadProcessingTimeoutOccured | 头部过滤时间超时


## '>7.3 回调函数调用详情

DLL与感测头建立高速数据通信后，DLL通过独立通信线程实时接收LJ-S8000传送的轮廓数据并暂时储存在DLL的内部缓存 （buffer）。

当缓存中的轮廓数据达到指定数量时，将调用图像完成回调函数。

除图像传输完成外，当发生通信异常等问题时，也通过调用回调函数通知主程序，请参照 [回调函数错误代码](#回调函数错误代码)进行问题排查与解决。

## '>7.4 图像获取时序图

LJ-S8000感测头LJ Developer通讯库主程序
- LJ-S8000感测头LJ Developer通讯库主程序loop[实时缓存轮廓数据]满足条件后，根据轮廓数据创建图像10、主程序在回调函数结束后对复制的图像执行图像处理loop[连续取图测量时循环执行部分]1、调用连接指令CommunicationOpen2、创建Ethernet连接3、调用开始图像传输指令StartImageReceiving4、创建图像传输专用通道[用于实时传输轮廓数据]5、发出触发StartMeasure6、发送触发信号使用图像传输通道实时传送轮廓数据写入内部缓存(buffer)7、调用回调函数通知主程序获取图像8、回调函数内复制图像数据9、回调函数返回[不建议在回调函数内直接处理图像]11、停止图像传输StopImageReceiving12、断开图像传输通道13、调用断开连接指令CommunicationClose14、断开Ethernet连接
# '>8 函数

## 命名空间/类名称
本章中所述的全部函数、结构体、枚举定义，均位于如下类（LjDevCommunication.Ljs8If）：命名空间/NameSpace：LjDevCommunication

- 类/Class:Ljs8If


## '>8.1 函数一览

本通讯库的函数不支持多线程的调用。请从单一线程调用函数。

### '>8.1.1 对DLL的操作

即使感测头发生系统错误，也会被正常处理。


**函数名** | **概要** | **特殊错误代码**

[Initialize](#Initialize) | 初始化 DLL | -

[Finalize](#Finalize) | DLL 终止处理 | -


### '>8.1.2 建立/断开与感测头之间的Ethernet连接

即使感测头发生系统错误，也会被正常处理。


**函数名** | **概要** | **特殊错误代码**

[CommunicationOpen](#CommunicationOpen) | 创建PC与感测头的以太网连接 | -

[CommunicationClose](#CommunicationClose) | 断开PC与感测头间的以太网连接 | -


### '>8.1.3 硬件控制相关

附有 *1 的指令发生系统错误时，可能无法正常处理。


**函数名** | **概要** | **特殊错误代码**

[ControlLaser](#ControlLaser) | 控制激光On/OFF^*1^ | -

[GetError](#GetError) | 获取感测头系统错误 | -

[ClearError](#ClearError) | 清除感测头的系统错误 | -

[GetAttentionStatus](#GetAttentionStatus) | 获取SCMD_READY / TRG_READY / MEM_FULL的状态 | -


### '>8.1.4 测量控制相关

在感测头系统错误状态下，如下函数处理失败。


**函数名** | **概要** | **特殊错误代码**

[StartMeasure](#StartMeasure) | 发出触发 | [0x8049/0x80A0](#特殊错误代码)

[ClearMemory](#ClearMemory) | 清除感测头内存 | -


### '>8.1.5 变更/读取设定相关

在感测头系统错误状态下，处理失败。


**函数名** | **概要** | **特殊错误代码**

[SetSetting](#SetSetting) | 修改感测头内的设定参数值 | [0x8032/0x8048](#特殊错误代码)

[GetSetting](#GetSetting) | 读取感测头内的设定参数值 | -

[InitializeSetting](#InitializeSetting) | 将指定编号的程序恢复到出厂默认设定状态 | [0x8048](#特殊错误代码)

[ReflectSetting](#ReflectSetting) | 将设定写入区域的内容生效到运行设定区域或保存区域中 | [0x8048](#特殊错误代码)

[RewriteTemporarySetting](#RewriteTemporarySetting) | 用运行设定区域或保存区域中的设定覆盖设定写入区域的内容 | -

[CheckMemoryAccess](#CheckMemoryAccess) | 确认是否正在对设定保存区域进行保存处理 | -

[ChangeActiveProgram](#ChangeActiveProgram) | 切换活动程序编号 | [0x8048](#特殊错误代码)

[GetActiveProgram](#GetActiveProgram) | 获取活动程序编号 | -


### '>8.1.6 图像获取相关

使用专用高速通信通道、从感测头实时获取轮廓数据并创建图像时使用。

在感测头系统错误状态下，处理失败。


**函数名** | **概要** | **特殊错误代码**

[StartImageReceiving](#StartImageReceiving) | 与感测头建立高速通信 然后开始获取图像数据 | [0x4009/0x8081/0x80A0 0x80A1/0x80A2/0x80A3 0x80A4/0xA002](#特殊错误代码)

[StopImageReceiving](#StopImageReceiving) | 停止获取图像数据 并切断与感测头的高速通信 | -

[ImageReceivedCallback](#图像接收完成回调函数) | 图像获取时，调用回调函数通知主程序。对应的委托定义 | -


## '>8.2 函数说明

大部分函数的返回值均为 int 类型。正常时返回 0 （无异常），当函数执行出现异常时，根据异常内容返回对应错误代码。

返回值有效位为下位2BYTE(上位的 2BYTE 为保留位，暂未使用)。

所有函数函通用的返回代码，请参照 [通讯库通用错误代码](#通讯库通用错误代码)。若函数存在个别的错误代码，请参照本章各函数的说明。

### 8.2.1  对DLL的操作

#### '>■ Initialize（DLL初始化）

在应用程序启动时，请务必执行1次此函数初始化DLL。

```


xxxxxxxxxx
```

```
///
```

```
/// 初始化 DLL（请务必在应用程序启动时执行1次）
```

```
/// 无特殊错误代码
```

```
///
```

```
public static int Initialize();
```

#### '>■ Finalize（DLL处理终止）

在应用程序结束前，请务必执行1次此函数终止DLL内部处理。

```


xxxxxxxxxx
```

```
///
```

```
/// 终止DLL的内部处理（请务必在应用程序结束前执行1次）
```

```
/// 无特殊错误代码
```

```
///
```

```
public static int Finalize();
```

### 8.2.2 建立/断开与感测头之间的Ethernet连接

#### '>■ CommunicationOpen（创建PC与感测头的以太网连接）

与感测头建立连接，使设备能够与通过 Ethernet 连接的感测头进行通信。

```


xxxxxxxxxx
```

```
/// 与感测头建立连接，使设备能够与通过 Ethernet 连接的感测头进行通信
```

```
/// 同时、传入的IP地址在开始图像高速传输时会被使用
```

```
/// 将当前连接对应的感测头在DLL内部定义编号为deviceId指定的数值,其他函数将使用此编号进行已连接的感测头的指定
```

```
/// 无特殊错误代码
```

```
///
```

```
public static int CommunicationOpen(
```

```
    /// [输入]设备ID
```

```
    int deviceId,
```

```
    /// [输入]指定目标感测头的IP地址，长度为4
```

```
    byte[] ipaddress,
```

```
    // [输入]指定目标感测头的指令端口号
```

```
    ushort portNo);
```

> 注意点：1、1台PC可以同时通信的感测头台数上限为6台（连接超过 6 台时，无法确认或保证动作）2、设备ID可在0~127之间自行选择，但是，不同感测头连接时必须指定为不同的ID3、1台感测头最多可以同时与3台PC进行以太网通讯。当连接到第4台PC时，已连接的3台PC中，会将已连接的 3 台PC中最终通信时间距今最久的连接断开4、1台感测头只能与1台PC上进行高速数据通信5、请在LJ-S Navigator软件关闭的状态下开启高速数据通信

#### '>■ CommunicationClose（断开PC与感测头间的以太网连接）
断开PC与感测头之间的Ethernet连接。在未建立连接的状态下调用时，不做处理直接正常返回。

```


xxxxxxxxxx
```

```
///
```

```
/// 断开PC与感测头之间的Ethernet连接
```

```
/// 无特殊错误代码
```

```
///
```

```
public static int CommunicationClose(
```

```
    /// [输入]要操作的设备ID
```

```
    int deviceId);
```

> 注意点：设备ID用于指定要操作的感测头，请传入创建感测头连接时指定的数值，详情请参照[创建PC与感测头之间的以太网连接](#CommunicationOpen)

### 8.2.3 硬件控制相关

#### '>■ ControlLaser（控制激光ON/OFF）
控制激光ON[允许发光]或OFF[禁止发光]。

```


xxxxxxxxxx
```

```
///
```

```
/// 控制激光ON[允许发光]或OFF[禁止发光]
```

```
/// 无特殊错误代码
```

```
///
```

```
public static int ControlLaser(
```

```
    /// [输入]要操作的设备ID
```

```
    int deviceId,
```

```
    /// [输入]指定激光的状态[0：禁止发光 其他数值：允许发光]
```

```
    byte state);
```

> 注意点：设备ID用于指定要操作的感测头，请传入创建感测头连接时指定的数值，详情请参照[创建PC与感测头之间的以太网连接](#CommunicationOpen)

#### '>■ GetError（获取感测头系统错误）

获取感测头当前的硬件系统错误信息，有关获取到的错误代码含义，请参照[感测头错误代码](#感测头错误代码)

```


xxxxxxxxxx
```

```
///
```

```
/// 获取感测头当前的系统错误信息
```

```
/// 无特殊错误代码
```

```
///
```

```
public static int GetError(
```

```
    /// [输入]要操作的设备ID
```

```
    int deviceId,
```

```
    /// [输出]实际获取到的系统错误的个数
```

```
    ref byte errorCount,
```

```
    /// [输出]获取到的系统错误
```

```
    ref ushort[] errorCodes);
```

> 注意点：1、设备ID用于指定要操作的感测头，请传入创建感测头连接时指定的数值，详情请参照[创建PC与感测头之间的以太网连接](#CommunicationOpen)2、若感测头当前未发生系统错误，则errorCount为03、当前函数返回值，请参照[通讯库通用错误代码](#通讯库通用错误代码)，errorCodes内的错误代码，请参照[感测头错误代码](#感测头错误代码)

#### '>■ ClearError（解除感测头系统错误）

解除感测头的对应系统错误。在所有系统错误被成功解除前，感测头将一直处于不能测量的状态。

```


xxxxxxxxxx
```

```
///
```

```
/// 解除感测头的对应系统错误
```

```
/// 无特殊错误代码
```

```
///
```

```
public static int ClearError(
```

```
    /// [输入]要操作的设备ID
```

```
    int deviceId,
```

```
    /// [输入]需要解除的错误的错误代码，仅限0x00CC和0x00EB错误
```

```
    ushort errCode);
```

> 注意点：1、设备ID用于指定要操作的感测头，请传入创建感测头连接时指定的数值，详情请参照[创建PC与感测头之间的以太网连接](#CommunicationOpen)2、并非所有的硬件系统错误都可解除，可以通过此函数解除的错误如下：
> 	0x00CC：无法读取配置文件
> 	0x00EB：配置文件与当前头版本不兼容3、上述错误外其他错误的解决方案，请参照[感测头错误代码](#感测头错误代码)。

#### '>■ GetAttentionStatus（获取SCMD_READY / TRG_READY / MEM_FULL的状态）

读取感测头SCMD_READY / TRG_READY / MEM_FULL的当前状态。

```


xxxxxxxxxx
```

```
///
```

```
/// 读取感测头SCMD_READY / TRG_READY / MEM_FULL的当前状态
```

```
/// 无特殊错误代码
```

```
///
```

```
public static int GetAttentionStatus(
```

```
    /// [输入]要操作的设备ID
```

```
    int deviceId,
```

```
    /// [输出]获取到的状态字，ON:1、OFF:0
```

```
    /// 3bit：SCMD_READY，5bit：TRG_READY，6bit：MEM_FULL
```

```
    ///
```

```
    ref ushort attentionStatus);
```

> 注意点：1、设备ID用于指定要操作的感测头，请传入创建感测头连接时指定的数值，详情请参照[创建PC与感测头之间的以太网连接](#CommunicationOpen)2、attentionStatus为获取到的状态字，使用3、5、6bit分别代表SCMD_READY、TRG_READY和MEM_FULL，其他位为保留位。
> MSB(最高有效位)        MSB(最低有效位)15...76(MEM_FULL)5(TRG_READY)43(SCMD_READY)2103、指定位置bit为1时，对应状态为ON，指定位置bit为0时，对应状态为OFF

### 8.2.4 硬件控制相关

#### '>■ StartMeasure（发送触发信号）

发出触发。

```


xxxxxxxxxx
```

```
///
```

```
/// 发出触发
```

```
/// 特殊错误代码:
```

```
/// 0x8049:由于 TRG_READY 处于 OFF 状态，因此无法发送触发信号。
```

```
/// 0x80A0:由于LASER_ON端子为OFF等原因，因此无法发送触发信号。
```

```
///
```

```
public static extern int StartMeasure(
```

```
        /// [输入]要操作的设备ID
```

```
        int deviceId);
```

> 注意点：设备ID用于指定要操作的感测头，请传入创建感测头连接时指定的数值，详情请参照[创建PC与感测头之间的以太网连接](#CommunicationOpen)

#### '>■ ClearMemory（清除感测头内存）

将感测头内存中保留的轮廓数清除。

```


xxxxxxxxxx
```

```
///
```

```
/// 将感测头内存中保留的轮廓数清除
```

```
/// 特殊错误代码:无
```

```
///
```

```
public static extern int ClearMemory(
```

```
        /// [输入]要操作的设备ID
```

```
        int deviceId);
```

> 注意点：1、设备ID用于指定要操作的感测头，请传入创建感测头连接时指定的数值，详情请参照[创建PC与感测头之间的以太网连接](#CommunicationOpen)2、清空感测头内存会导致进行中的高速数据通信中断，需重新连接高速通信

### 8.2.5 写入/读取设定相关

#### '>指定要执行写入/读取的目标设定项目

在写入/读取设定时，需要指定特定的设定项目。使用目标设定项用于指定特定设定。

目标设定项既可以指定单个设定项目，也可以指定环境设定整体/通用测量设定整体或检测程序整体(0~15)。

目标设定项结构体定义如下：

```


xxxxxxxxxx
```

```
/// 用于指定特定设定项目参数的结构体
```

```
public struct Ljs8IfTargetSetting
```

```
{
```

```
    /// 指定设定项是环境设定/测量通用设定/程序0~15中的哪一项
```

```
    public byte _type;
```

```
    /// 指定设定项是触发设定/拍摄设定/轮廓设定中的哪一项
```

```
    public byte _category;
```

```
    /// 基于Type和Category后指定具体的设定项目
```

```
    public byte _item;
```

```
    /// 保留项,固定为0
```

```
    public byte _reserve;
```

```
    /// Target1~4,据目标设定项，可能需要进行相应的指定。无需设定时，固定为0
```

```
    public byte _target1;
```

```
    public byte _target2;
```

```
    public byte _target3;
```

```
    public byte _target4;
```

```
};
```

> ※要读取或修改的设定项不同时，如上成员需指定为特定的固定数值
> - 修改单个设定项目时，各成员项目分别的数值，请参照[发送/接收设定项目详情](#发送/接收设定项目详情)
> - 批量修改环境设定/通用测量设定/检测程序，或发送本地设定文件时，请参照[批量发送/接收设定](#批量发送/接收设定)

#### '>■ SetSetting（发送设定）

修改感测头内的设定参数值，可用于个别设定项目的修改或设定程序的批量修改。

```


xxxxxxxxxx
```

```
///
```

```
/// 修改感测头内的设定参数值
```

```
/// 特殊错误代码:
```

```
/// 0x8032:指令长度错误(设定数据未达到规定大小时等)
```

```
/// 0x8048:无法执行，因为 SCMD_READY 已关闭（成像处理或图像处理正在进行中）
```

```
///
```

```
public static int SetSetting(
```

```
    /// [输入]要操作的设备ID
```

```
    int deviceId,
```

```
    /// [输入]目标写入区域
```

```
    byte depth,
```

```
    /// [输入]要修改的特定设定项目
```

```
    Ljs8IfTargetSetting targetSetting,
```

```
    /// [输入]要发送到感测头的设定数据
```

```
    ref byte[] data,
```

```
    /// [输出]发生设定错误时的详情
```

```
    ref uint error);
```

> 注意点：
> - 设备ID用于指定要操作的感测头，请传入创建感测头连接时指定的数值，详情请参照[创建PC与感测头之间的以太网连接](#CommunicationOpen)
> - depth目标写入区域：0-设定写入区域(WRITE)，1-运行设定区域(RUNNING)，2-保存区域(SAVE)
> 	关于目标写入区域的含义及注意点，请参照[目标设定区域](#目标设定区域)
> 	设定写入RUNNING或SAVE时，测量/高速通信将被中断
> - targetSetting为要修改的特定设定项目。
> 	修改单个设定项目时，请参照[发送/接收设定项目详情](#发送/接收设定项目详情)
> 	批量修改环境设定/通用测量设定/检测程序，或发送本地设定文件时，请参照[批量发送/接收设定](#批量发送/接收设定)
> - data为要发送到感测头的设定数据。不同的设定项目的设定数据长度不同，请参照targetSetting指定的设定项目。
> - error为设定写入错误时的设定错误代码，详情请参照[设定错误详情](#设定错误详情)

#### '>■ GetSetting（获取设定）

读取感测头内的设定参数值，可用于个别设定项目的读取或设定程序的批量读取。

```


xxxxxxxxxx
```

```
///
```

```
/// 读取感测头内的设定参数值
```

```
/// 无特殊错误代码
```

```
///
```

```
public static int GetSetting(
```

```
    /// [输入]要操作的设备ID
```

```
    int deviceId,
```

```
    /// [输入]目标读取区域
```

```
    byte depth,
```

```
    /// [输入]要读取的特定设定项目
```

```
    Ljs8IfTargetSetting targetSetting,
```

```
    /// [输出]读取到的设定数据
```

```
    ref byte[] data);
```

> 注意点：
> - 设备ID用于指定要操作的感测头，请传入创建感测头连接时指定的数值，详情请参照[创建PC与感测头之间的以太网连接](#CommunicationOpen)
> - depth目标读取区域：0-设定写入区域(WRITE)，1-运行设定区域(RUNNING)，2-保存区域(SAVE)
> 	关于目标读取区域的含义及注意点，请参照[目标设定区域](#目标设定区域)
> - targetSetting为要读取的特定设定项目。
> 	读取单个设定项目时，请参照[发送/接收设定项目详情](#发送/接收设定项目详情)
> 	批量读取环境设定/通用测量设定/检测程序，请参照[批量发送/接收设定](#批量发送/接收设定)
> - data为读取到的设定数据，设定数据的含义，请参照[发送/接收设定项目详情](#发送/接收设定项目详情)

#### '>■ InitializeSetting（初始化设定）

将指定编号的程序恢复到出厂默认设定状态。

```


xxxxxxxxxx
```

```
///
```

```
/// 将指定编号的程序恢复到出厂默认设定状态
```

```
/// 特殊错误代码:
```

```
/// 0x8048:无法执行，因为 SCMD_READY 已关闭（成像处理或图像处理正在进行中）
```

```
///
```

```
public static int InitializeSetting(
```

```
    /// [输入]要操作的设备ID
```

```
    int deviceId,
```

```
    /// [输入]要初始化的目标设定区域
```

```
    byte depth,
```

```
    /// [输入]要初始化的程序号,输入范围0~15
```

```
    byte target);
```

> 注意点：
> - 设备ID用于指定要操作的感测头，请传入创建感测头连接时指定的数值，详情请参照[创建PC与感测头之间的以太网连接](#CommunicationOpen)
> - depth指定要初始化的目标设定区域：0-设定写入区域(WRITE)，1-运行设定区域(RUNNING)，2-保存区域(SAVE)
> 	关于目标读取区域的含义及注意点，请参照[目标设定区域](#目标设定区域)
> - depth指定为1、即运行设定区域时，设定写入区域(WRITE)会同时被初始化
> - depth指定为2、即保存区域时，设定写入区域、运行设定区域也会同时被初始化
> - target为要初始化的程序号，请勿传入大于15的数值。

#### '>■ RewriteTemporarySetting（更新设定写入区域）

将设定写入区域的内容生效到运行设定区域或保存区域中。

在写入多项设定参数，为了避免让暂时的设定不匹配导致感测头运行错误，可暂时写入设定写入区域，再将设定从本区域反映到运行设定区域或保存区域。

目标设定区域的含义请参照[目标设定区域](#目标设定区域)，使用过程示例请参照[修改多个设定项目示例](#修改多个设定项目时)。

```


xxxxxxxxxx
```

```
///
```

```
/// 将设定写入区域的内容生效到运行设定区域或保存区域中
```

```
/// 无特殊错误代码
```

```
///
```

```
public static int RewriteTemporarySetting(
```

```
    /// [输入]要操作的设备ID
```

```
    int deviceId,
```

```
    /// [输入]要生效的目标设定区域,可选1/2
```

```
    byte depth,
```

```
    /// [输出]发生设定错误时的详情
```

```
    ref uint error);
```

> 注意点：
> - 设备ID用于指定要操作的感测头，请传入创建感测头连接时指定的数值，详情请参照[创建PC与感测头之间的以太网连接](#CommunicationOpen)
> - depth指定将设定写入区域生效到的目标设定区域：1-运行设定区域(RUNNING)，2-保存区域(SAVE)
> - error为设定写入错误时的设定错误代码，详情请参照[设定错误详情](#设定错误详情)

#### '>■ ReflectSetting（设定写入区域的生效请求）

使用运行设定区域（RUNNING）或保存区域(SAVE)的设定更新设定写入区域（WRITE）的内容。

设定区域的含义请参照[目标设定区域](#目标设定区域)。

```


xxxxxxxxxx
```

```
///
```

```
/// 使用运行设定区域（RUNNING）或保存区域(SAVE)的设定更新设定写入区域（WRITE）的内容
```

```
/// 特殊错误代码:
```

```
/// 0x8048:无法执行，因为 SCMD_READY 已关闭（成像处理或图像处理正在进行中）
```

```
///
```

```
public static int ReflectSetting(
```

```
    /// [输入]要操作的设备ID
```

```
    int deviceId,
```

```
    /// [输入]用哪个设定区域的参数覆盖设定写入区域,可选1/2
```

```
    byte depth);
```

> 注意点：
> - 设备ID用于指定要操作的感测头，请传入创建感测头连接时指定的数值，详情请参照[创建PC与感测头之间的以太网连接](#CommunicationOpen)
> - depth指定用哪个设定区域的参数覆盖设定写入区域：1-运行设定区域(RUNNING)，2-保存区域(SAVE)

#### '>■ CheckMemoryAccess（确认设定保存区域的保存处理情况）

确认感测头是否正在写入设定保存区域(SAVE)。

将设定参数写入设定保存区域时，由于写入设定保存区域需要耗费一定时间，函数调用后感测头内部并非立刻完成。

若感测头正在向设定保存区域写入设定时出现电源关闭，检测设定将丢失，感测头也可能会出现故障。

因此、使用[SetSetting](#SetSetting) /[InitializeSetting](#InitializeSetting) /[ReflectSetting](#ReflectSetting)等函数将设定值写入到保存区域后，请务必使用本函数确认写入已完成后再关闭电源。

设定区域的含义请参照[目标设定区域](#目标设定区域)。

```


xxxxxxxxxx
```

```
///
```

```
/// 确认感测头是否正在写入设定保存区域(SAVE)
```

```
/// 无特殊错误代码
```

```
///
```

```
public static int CheckMemoryAccess(
```

```
    /// [输入]要操作的设备ID
```

```
    int deviceId,
```

```
    /// [输出]0:感测头未访问设定写入区域 其他值：感测头正在访问设定写入区域
```

```
    ref byte busy);
```

> 注意点：
> - 设备ID用于指定要操作的感测头，请传入创建感测头连接时指定的数值，详情请参照[创建PC与感测头之间的以太网连接](#CommunicationOpen)
> - busy为当前感测头设定写入区域状态，当pbyBusy不为0时，表示感测头仍在访问设定写入区域，请勿关闭电源。

#### '>■ ChangeActiveProgram（切换活动程序编号）

切换感测头的当前活动程序编号。

```


xxxxxxxxxx
```

```
///
```

```
/// 切换感测头的当前活动程序编号
```

```
/// 特殊错误代码:
```

```
/// 0x8048:无法执行，因为 SCMD_READY 已关闭（成像处理或图像处理正在进行中）
```

```
///
```

```
public static int ChangeActiveProgram(
```

```
    /// [输入]要操作的设备ID
```

```
    int deviceId,
```

```
    /// [输入]要切换到的程序编号,请勿指定大于15的数值
```

```
    byte programNo);
```

> 注意点：
> - 设备ID用于指定要操作的感测头，请传入创建感测头连接时指定的数值，详情请参照[创建PC与感测头之间的以太网连接](#CommunicationOpen)
> - programNo 指定与活动程序编号相同编号或无效的程序编号时，仍会执行程序切换 (内存清除等)，但不会切换程序。

#### '>■ GetActiveProgram（获取活动程序编号）

读取感测头的当前活动程序编号。

```


xxxxxxxxxx
```

```
///
```

```
/// 读取感测头的当前活动程序编号
```

```
/// 无特殊错误代码
```

```
///
```

```
public static int GetActiveProgram(
```

```
    /// [输入]要操作的设备ID
```

```
    int deviceId,
```

```
    /// [输出]要切换到的程序编号,请勿指定大于15的数值
```

```
    ref byte programNo);
```

> 注意点：
> - 设备ID用于指定要操作的感测头，请传入创建感测头连接时指定的数值，详情请参照[创建PC与感测头之间的以太网连接](#CommunicationOpen)

#### '>设定的写入处理

在设定的写入处理中用到的函数有如下 4 种。

• [SetSetting](#SetSetting)（发送设定）

• [ReflectSetting](#ReflectSetting)（设定写入区域的生效请求）

• [RewriteTemporarySetting](#RewriteTemporarySetting)（更新设定写入区域）

• [CheckMemoryAccess](#CheckMemoryAccess)（确认保存区域的保存处理情况）


##### '>• 目标设定区域

发送设定时，需要通过 SetSetting 指定 Depth。 Depth 的各选项及对应作用如下所示:


Depth | 作用

Ljs8IfSettingDepth.Write （设定写入区域） | 对动作不产生影响的设定区域 变更多项设定时，为了避免让暂时的设定不匹配导致感测头运行错误，可在本区域改写设定后，再将设定从本区域反映到运行设定区域或保存区域 在不返回错误信息的情况下变更感测头的动作。

Ljs8IfSettingDepth.Running （运行设定区域） | 感测头运行中使用的设定值。 在感测头启动时，被初始化为保存区域的设定值。 但是，该设定区域的设定值在关闭电源后就会丢失。（重新启动时，被初始化为保存区域的设定)

Ljs8IfSettingDepth.Save （保存区域) | 该区域中写入的设定在关闭电源后仍会保存在感测头中。 **写入该区域时需要耗费更多时间**。 （可通过 CheckMemoryAccess 确认是否正在写入该区域。请通过该函数确认写入完成后再关闭电源）


##### '>• 修改多个设定项目时


将多项设定逐项写入设定写入区域（WRITE）变更设定2
SetSetting变更设定1
SetSetting....变更设定n
SetSetting更新设定写入区域
ReflectSetting
更新RUNNING
> 在写入 RUNNING 或 SAVE 时，会检查设定的匹配性，如果存在不匹配则会返回错误。（有关错误 的详情，请参照 [设定错误详情](#设定错误详情)）因此，变更多项设定时，如果逐项将设定写入 RUNNING （SAVE），如果设定项目引发不匹配，设定将不被反映到感测头。将多项设定写入 WRITE，在编写匹配的设定后，最后将集中反映到感测头。如需将不匹配的 WRITE 设定还原为控 制器内的设定，请使用 [RewriteTemporarySetting](#RewriteTemporarySetting)。注意：1、更新设定写入区域时，设定内将被写入 RUNNING 或SAVE，测量/高速通信将被中断2、设定写入 SAVE 的过程中，请勿关闭感测头的电源。可通过 [CheckMemoryAccess](#CheckMemoryAccess) 确认设定是否已写入3、将变更设定n 的目标写入区域改为 RUNNING，也会获得同样的结果（可以不使用[ReflectSetting](#ReflectSetting)）

##### '>• 仅修改单个设定项目时


修改单个检测设定需要不需要,仅变更运行设定断电后是否保存SetSetting
写入SAVESetSetting
写入RUNNING
> 注意：1、设定写入RUNNING或SAVE时，测量/高速通信将被中断2、在设定写入 SAVE 的过程中，请勿关闭感测头的电源。可通过  [CheckMemoryAccess](#CheckMemoryAccess) 确认设定是否已写入

##### '>• 将本地的设定文件写入感测头时[批量修改设定]
写入感测头设定本地文件读取感测头设定使用SetSetting
写入环境设定使用SetSetting
写入测量通用设定使用SetSetting
写入单个测量程序
程序0~程序15保存环境设定内容
二进制格式保存测量通用设定内容
二进制格式保存测量程序内容
二进制格式使用GetSetting
读取环境设定使用GetSetting
读取测量通用设定使用GetSetting
读取单个测量程序
程序0~程序15
> 注意：1、设定写入RUNNING或SAVE时，测量/高速通信将被中断2、在设定写入 SAVE 的过程中，请勿关闭感测头的电源。可通过 [CheckMemoryAccess](#CheckMemoryAccess)确认设定是否已写入3、msss文件为LJ-S Navigator专用测量设定文件格式，此处不可用。请使用 [GetSetting](#GetSetting)读出并保存的二进制文件4、读取环境设定/测量通用设定/测量程序时的[目标设定项](#目标设定项)参数，请参照[批量发送/接收设定](#批量发送/接收设定)

#### '>设定错误详情

各类设定中，存在必须满足的匹配性要求。不满足匹配性要求的设定发送、设定写入区域的反映请求指令所反馈的设定错误详情 （error）如下所示。


Error数值 | 错误内容

0x1X020000^*1^ | 起始位置Y超出可设定范围

0x1X020001^*1^ | 使用范围Y超出可设定范围

0x1X040000^*1^ | 光量控制上限值＜下限值


> *1：X 代表程序编号，存储 0 至 F


### '>8.2.6 图像获取相关

#### '>■ StartImageReceiving（开始图像高速传输）

与感测头建立高速通信，然后开始获取图像数据。

```


xxxxxxxxxx
```

```
///
```

```
/// 从感测头读取设定内容后初始化PC端缓存并开启图像数据高速传输
```

```
/// 特殊错误代码:
```

```
/// 0x4009：滤波器计算模块尚未初始化
```

```
/// 0x8081：被指定为发送起始位置的数据不存在
```

```
/// 0x80A0：未成功建立高速通信用的TCP连接
```

```
/// 0x80A1：高速通信(图像传输)在执行前已经开始
```

```
/// 0x80A2/0x80A3：未进行高速数据通信(图像传输)的开始前准备
```

```
/// 0X80A4：要发送的目标数据被清除
```

```
/// 0xA002：由于图像行数超过16000行,无法开始图像数据获取
```

```
///
```

```
public static int StartImageReceiving(
```

```
    /// [输入]要操作的设备ID
```

```
    int deviceId,
```

```
    /// [输入]指定用于高速通信的端口编号
```

```
    ushort portNo,
```

```
    /// [输入]指定于图像获取完成时调用的回调函数
```

```
    ImageReceivedCallback callBack,
```

```
    /// [输入]是否自动修正图像比例为1:1
```

```
    bool equalizePixcelDensity,
```

```
    /// [输入]指定高速通信线程的用户自定义信息。在调用回调函数时会被使用
```

```
    uint threadId
```

```
);
```

```
///
```

```
/// equalizePixcelDensity = True
```

```
/// 基于上述参数，开始图像传输
```

```
///
```

```
public static int StartImageReceiving(
```

```
    /// [输入]要操作的设备ID
```

```
    int deviceId,
```

```
    /// [输入]指定用于高速通信的端口编号
```

```
    ushort portNo,
```

```
    /// [输入]指定于图像获取完成时调用的回调函数
```

```
    ImageReceivedCallback callBack,
```

```
    /// [输入]指定高速通信线程的用户自定义信息。在调用回调函数时会被使用
```

```
    uint threadId
```

```
);
```

> 注意点：
> - 设备ID用于指定要操作的感测头，请传入创建感测头连接时指定的数值，详情请参照[创建PC与感测头之间的以太网连接](#CommunicationOpen)
> - 回调函数接口定义及注意点，请参照[图像接收完成回调函数](#图像接收完成回调函数)
> - 图像获取的流程示例，请参照[图像获取时序图](#图像获取时序图)

#### '>■ StopImageReceiving（停止图像传输）

断开与感测头的高速通信通道。

```


xxxxxxxxxx
```

```
///
```

```
/// 从感测头读取设定内容后初始化PC端缓存并开启图像数据高速传输
```

```
/// 无特殊错误代码
```

```
///
```

```
public static int StopImageReceiving(
```

```
    /// [输入]要操作的设备ID
```

```
    int deviceId);
```

> 注意点：
> - 设备ID用于指定要操作的感测头，请传入创建感测头连接时指定的数值，详情请参照[创建PC与感测头之间的以太网连接](#CommunicationOpen)
> - 若当前正在获取图像，且已经获取了一定数量的轮廓数据，在高速通信的同时将调用回调函数将已收到的数据传递到主程序

# 9 错误代码

## '>9.1 通讯库错误代码

### 9.1.1 通用错误返回代码

下列返回代码，将在DLL内部被判断并返回。
 具体来说，返回代码会在与感测头的通信失败，或因通信库的内部问题导致未执行处理时返回。


定义名称 | 数据 （下位2byte） | 发生原因

Ljs8IfRcErr.Ok | 0x0000 | 正常完成

Ljs8IfRcErr.Open | 0x1000 | 开启TCP连接失败

Ljs8IfRcErr.NotOpen | 0x1001 | 未连接到感测头

Ljs8IfRcErr.Send | 0x1002 | 发送指令失败

Ljs8IfRcErr.Receive | 0x1003 | 接收感测头响应时失败

Ljs8IfRcErr.Timeout | 0x1004 | 接收感测头响应时超时

Ljs8IfRcErr.NoMemory | 0x1005 | 保护内存失败

Ljs8IfRcErr.Parameter | 0x1006 | 参数内容错误

Ljs8IfRcErr.RecvFmt | 0x1007 | 感测头响应内容不正确

Ljs8IfRcErr.HiSpeedNoDevice | 0x1009 | 高速通信初始化失败

Ljs8IfRcErr.HiSpeedOpenYet | 0x100A | 高速通信重复初始化

Ljs8IfRcErr.FilterNoMemory | 0x4005 | 无法确保 PC 图像过滤器的内存安全

Ljs8IfRcErr.FilterParameter | 0x4006 | PC图像过滤器参数无效

Ljs8IfRcErr.FilterUnsupported | 0x4007 | 不支持 PC 图像过滤器

Ljs8IfRcErr.FilterInit | 0x4009 | 过滤器计算模块尚未初始化

Ljs8IfRcErr.UnsupportedImageSize | 0x400A | 图片尺寸超出可处理尺寸


### 9.1.2 感测头处理错误返回代码

下列错误代码，在DLL与感测头正常通信，但是由于感测头无法处理等原因而发生。


数据 （下位2byte） | 发生原因

0x8031 | 未定义指令（向感测头发送了不支持的指令）

0x8041 | 状态错误（感测头正在发生系统错误等）

0x8042 | 参数错误（指令包含了不正确的参数）

0x8050 | 兼容性错误（由于感测头的版本过低，功能无法使用时）

0x8051 | 传感器正在启动（打开电源后，大约需要50秒才能接受命令）


### '>9.1.3 特殊错误返回代码

下列错误代码，在特定的函数使用时，由于设定参数不正确或感测头设定不符合预期而发生。


数据 （下位2byte） | 发生原因 | 相关函数

0x8048 | 无法执行，因为 SCMD_READY 已关闭（成像处理或图像处理正在进行中） | [SetSetting](#SetSetting) [InitializeSetting](#InitializeSetting) [ReflectSetting](#ReflectSetting) [ChangeActiveProgram](#ChangeActiveProgram)

0x8049 | 由于 TRG_READY 处于 OFF 状态，因此无法发出触发器。 | [StartMeasure](#StartMeasure)

0x80A0 | 由于LASER_ON端子为OFF等原因，未成功进行批处理测量开始处理。 | [StartMeasure](#StartMeasure)

0x8032 | 指令长度错误 （设定数据未达到规定大小时等） | [SetSetting](#SetSetting)

0x8081 | 被指定为发送起始位置的数据不存在 | [StartImageReceiving](#StartImageReceiving)

0x80A0 | 未成功建立高速通信用的TCP连接 | [StartImageReceiving](#StartImageReceiving)

0x80A1 | 高速通信（图像传输）在执行前已经开始 | [StartImageReceiving](#StartImageReceiving)

0x80A2/0x80A3 | 未进行高速数据通信(图像传输)的开始前准备 | [StartImageReceiving](#StartImageReceiving)

0x80A4 | 发生的目标数据被清除 | [StartImageReceiving](#StartImageReceiving)

0xA002 | 由于图像总行数超过16000行，无法开始图像数据获取 启用了自动比例修正后，以补正后的图像行数为判断标准 | [StartImageReceiving](#StartImageReceiving)


## '>9.2 感测头错误代码

下列错误代码，为感测头内部的硬件系统错误，并非通讯库的返回代码。
当发生导致测量停止的系统错误时，感测头进入系统错误状态。
具体的系统错误代码可以通过如下两种方式获取：

使用LJ-S Navigator连接到感测头，软件上会显示系统错误提示消息

使用[GetError](#GetError)函数，可以获取当前感测头的系统错误代码


错误代码 | 错误内容 | 发生原因 | 解决方法

0x0001~0x0052 0x0057~0x005D 0x00C1~0x00C8 0x00CA~0x00CB 0x00CE~0x00CF 0x00D1~0x00D2 0x00D4~0x00D5 0x00D7~0x00D8 0x00DB~0x00DE 0x00E1~0x00E4 0x00E6~0x00EA | 这是感测头内部器件的异常。 | 感测头的内部器件可能发生故障。 | 如果再次接通电源仍无法正常运行， 请联系就近的办事处。

0x0053~0x0056 | 感测头温度异常。 | 感测头周围的环境温度可能较高。 感测头的内部器件可能发生故障。 | 请确认感测头的周围温度。 如果再次接通电源后仍无法正常运行， 请联系就近的办事处。

0x00C9、0x00D3 | 更新异常。 | 感测头固件的更新过程中 因断电等原因导致未能正常完成更新。 | 请再次执行感测头固件的更新。

0x00CC | 设定数据异常。 | 未能读取感测头内存中保存的数据 或未能读取感测头主机内置的SD的保存数据。 | 发生此错误时，感测头使用初始值的IP地址（192.168.0.1） 运行。 请确认已经正确插入了SD卡。 可按照LJ-S Navigator上显示的提示消息，解除错误。 解除错误后，系统会按出厂设定运行。

0x00EB | 配置数据与当前感测头版本不符。 | 由于感测头固件的更新导致变为可能不支持设定数据的状态。 | 可按照LJ-S Navigator上显示的提示消息，解除错误。 如果在LJ-S Navigator发送设定后发生了错误，请更新为最新的固件和 LJ-S Navigator。 解除错误后，除IP地址等通讯设定之外，系统会按出厂设定运行。


> - 发生错误时，错误输出（常闭）变为ON
> - 如果显示了上述以外的错误代码，请联系就近的办事处。

# '>10 附录

## '>10.1 发送/接收设定

通过发送设定[SetSetting](#SetSetting)、接收设定[GetSetting](#GetSetting)，分别对各项目发送/接收设定。
（各项目指的是环境设定 / 测量通用设定 / 程序 0 至 15 的各项设定参数）
如需批量进行环境设定、测量通用设定或各程序设定的发送/接收，而非单个设定参数的设定发送/接收，请参照[批量发送/接收设定](#批量发送/接收设定)。

Type分类如下：


 | 环境设定 | 测量通用设定 | 程序0~15

Type值 | 0x01 | 0x02 | 0x10~0x1F


## '>10.2 批量发送/接收设定

将Category 指定为 0xFF，即可发送/接收环境设定 / 测量通用设定 / 各程序的全部设定项目。


发送/接收对象 | Type | Category | Item | Target1~4 | 设定数据长度

环境设定 | 0x01 | 0xFF | 0x00 | 0x00 | 256 byte

测量通用设定 | 0x02 | 0xFF | 0x00 | 0x00 | 64 byte

程序0 | 0x10 | 0xFF | 0x00 | 0x00 | 10,980 byte

程序1 | 0x11 | 0xFF | 0x00 | 0x00 | 10,980 byte

... | ... | ... | ... | ... | ....

程序15 | 0x1F | 0xFF | 0x00 | 0x00 | 10,980 byte


## '>10.3 发送/接收设定项目详情

### 10.3.1 环境设定 设定项目列表

对于环境设定的设定项目，Type固定为0x01，Category固定为0x00，各项目的Item和Target如下：


设定项目 | Item | Target1-4 | 设定数据长度 | 补充说明

设备名称 | 0x00 | 0x00 | 64 byte | 最多 64 个字符。末尾不带 0 SHIFT-JIS

下次接通电源时动作 | 0x01 | 0x00 | 1 byte | 0：BOOTP→IP地址固定 1：IP地址固定 2：BOOTP

IP地址 | 0x04 | 0x00 | 4 byte | [IP地址规则^※1^](#环境设定注意点)

子网掩码 | 0x05 | 0x00 | 4 byte | [子网掩码规则^※2^](#环境设定注意点)

默认网关 | 0x06 | 0x00 | 4 byte | [默认网关规则^※3^](#环境设定注意点)

TCP指令端口号 | 0x07 | 0x00 | 2 byte | 1~65,535，不可以与高速端口相同

TCP高速端口号 | 0x08 | 0x00 | 2 byte | 1~65,535，不可以与指令端口相同

UDP端口号 | 0x09 | 0x00 | 2 byte | 1~65,535


> 注意点：
> - 下述IP地址视为不正确的IP地址：0.0.0.0、224.0.0.0 至 255.255.255.255
> - 下述地址将被视作不正确的子网掩码：0.0.0.0、255.255.255.255或从首位起， “1” 不连续
> 例如：255.255.255.64，二进制值时：11111111.11111111.11111111.01000000,由于“1”不连续，视为不正确
> - 下述地址将被视作不正确的默认网关：224.0.0.0 至 255.255.255.255


### 10.3.2 修改/读取测量通用设定 设定项目列表

对于测量通用设定的设定项目，Type固定为0x02，各项目的Item和Target如下：


设定项目 | Category | Item | Target1-4 | 设定数据长度 | 补充说明

输入端子过滤器长度 | 0x00 | 0x00 | 0x00 | 2 byte | 100~65,536 单位us

内存FULL时的动作 | 0x02 | 0x00 | 0x00 | 1 byte | 0：覆盖 1：停止


### 10.3.3 各程序内的设定时 设定项目列表

对于程序内的设定项目，Type根据程序号不同依次为0x10~0x1F


- 程序0对应的Type为0x10

- 程序1对应的Type为0x11

- 以此类推，程序15对应的Type为0x1F


#### ■ 驱动设定、触发设定内的设定项目


设定项目 | Category | Item | Target1-4 | 设定数据长度 | 补充说明

加减速上限 | 0x00 | 0x00 | 0x00 | 1 byte | 0：高速 1：中速 2：低速

往返拍摄 | 0x00 | 0x01 | 0x00 | 1 byte | 0：ON(往返） 1：OFF(单向）

触发延迟 | 0x01 | 0x00 | 0x00 | 2 byte | 0~999 单位：ms


#### ■ 拍摄设定内的设定项目


设定项目 | Category | Item | Target1~4 | 设定数据长度 | 补充说明

Y方向测量范围 | 0x02 | 0x00 | 0x00 | 4 byte | [Y方向测量范围设定值详情](#Y方向测量范围备注)

Z方向测量范围 | 0x02 | 0x01 | 0x00 | 4 byte | [Z方向测量范围设定值详情](#Z方向测量范围备注)

间隔点数-X | 0x03 | 0x01 | 0x00 | 1 byte | 1~2 根据设定点数N，数据点数将减少至1/N

间隔点数-Y | 0x03 | 0x0 | 0x00 | 1 byte | 1~8 根据设定点数N，数据点数将减少至1/N

曝光时间 | 0x04 | 0x00 | 0x00 | 1 byte | 0:15us 1:30us 2:60us 3:80us 4：120us 5:160us 6:210us 7:240uus 8:320us 9:380us 10:480us 11:640us 12:960us 13:1700us 14:4800us 15：9600us ※LJ-S015/025/040无法设定为4800us

动态量程 | 0x04 | 0x01 | 0x00 | 1 byte | 1~9

光量控制 控制模式 | 0x04 | 0x02 | 0x00 | 1 byte | 0：MANUAL 1：AUTO

光量控制 上限值 | 0x04 | 0x03 | 0x00 | 1 byte | 1~99

光量控制 下限值 | 0x04 | 0x04 | 0x00 | 1 byte | 1~99

峰值检测灵敏度 | 0x05 | 0x00 | 0x00 | 1 byte | 1 ~ 5

检测对象选择 | 0x05 | 0x01 | 0x00 | 16 byte | [检测对象选择详细设定值](#检测对象选择详细设定值)

峰值宽度过滤器 | 0x05 | 0x03 | 0x00 | 2 byte | byte0： 0:过滤器OFF 1：过滤器ON byte1：过滤器强度：1~5

死角数据插补 | 0x06 | 0x00 | 0x00 | 1 byte | 0：不进行插补 1：水平、垂直插补 2：线性插补


##### '>Y方向测量范围设定值


设定数据数组 | byte0~1 | byte2~3

设定值 | 使用范围Y LJ-S015：3200~6000 LJ-S025：2000~6400 LJ-S040：1600~6400 LJ-S080：1200~6400 | Y起始位置,需满足下述条件 1 ≤ 起始位置Y ≤ Y范围上限 - 使用范围Y + 1


##### '>Z方向测量范围设定值检测对象选择详细设定值


设定数据数组 | byte0 | byte1 | byte2~3

设定值 | 扩展区域ON/OFF 0：OFF 1：ON | 使用范围Z 0(宽)~11（窄） 可设定的范围因感测头型号而异 | 起始位置Z：0~1000 (以0.1%为单位、即0.0%-100.0%)


##### '>检测对象选择详细设定值


设定数据数组 | byte0 | byte1 | byte2~3 | byte4 | byte5

设定值 | 峰值选择 0：标准（最大光量） 1：Near 2：Far 3：抑制X方向异常反射 4：抑制Y方向异常反射 5：抑制XY方向异常反射 | 预留位 固定为0 | 超时时间：5~600 (单位：0.1s、即0.5-60秒) | 异常反射抑制X _强度：1~3 | 异常反射抑制Y _去除倾斜：1~5

 | byte6 | byte7 | byte8 | byte9~15 |

设定值 | 异常反射抑制Y_去除大小：1~5 | 异常反射抑制Y_亮度过滤器:0~100 单位：1%，0~100% | 异常反射抑制Y_分离阈值：2~100 单位0.1px，0.2~10.0 | 预留位 固定为0 |


#### ■ PC图像过滤器的设定项目


设定项目 | Category | Item | Target1~4 | 设定数据长度 | 补充说明

去除凸起状干扰 | 0x07 | 0x00 | 0x00 | 12 byte | [去除凸起状干扰详情](#去除凸起状干扰详情)

抑制无效像素 | 0x07 | 0x01 | 0x00 | 4 byte | [抑制无效像素详情](#抑制无效像素详情)


##### '>去除凸起状干扰详情


设定数据数组 | byte0 | byte1 | byte2 | byte3 | byte4~7 | byte8 | byte9 | byte10 | byte11

设定值 | 过滤器是否有效： 0:无效 1：有效 | 去除大小： 2~30 | 去除对象： 0：高 1：低 2：高/低两者 | 预留位 固定为0 | 去除阈值： 0~65535 | 是否指定处理方向： 0：无效 1：有效 | 处理方向： 0：X 1：Y 2：XY个别 | 去除大小X： 2~30 | 去除大小Y: 2~30


##### '>抑制无效像素详情


设定数据数组 | byte0 | byte1 | byte2 | byte3

设定值 | 过滤器是否有效： 0:无效 1：有效 | 抑制强度： 1~9 | 调整宽度： 0：大 1：小 | 抑制轮廓插补： 0：无效 1：有效
